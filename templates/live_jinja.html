{% extends "basetemplate.html" %}
{% block title %}Real Time Demand and Forecast{% endblock %}
{% block script %}
    {{ super() }}
    <!-- <meta http-equiv="refresh" content="30"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/c3.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dataTables.bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/buttons.bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fixedColumns.bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nv.d3.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-datepicker3.css') }}">
    <style>
        .bias-input-group .input-group-addon + .input-group-btn > .btn {border-radius: 0;}
        .bias-input-group .input-group-addon + .input-group-btn + .input-group-addon {border-right: 0; border-left: 0;}

        /* Datatables fixedColumns */
        th, td { white-space: nowrap; }
        div.dataTables_wrapper {
            width: auto;
            margin: 0 auto;
        }

        .btn-custom {
          width: 78px !important;
        }

        #chart2 svg {
            height: 500px;
            margin: 10px;
            min-width: 100px;
            min-height: 100px;
            /*
            Minimum height and width is a good idea to prevent negative SVG dimensions...
            For example width should be =< margin.left + margin.right + 1,
            of course 1 pixel for the entire chart would not be very useful, BUT should not have errors
            */
        }

        #surrchart svg {
            height: 500px;
            margin: 10px;
            min-width: 100px;
            min-height: 100px;
            /*
            Minimum height and width is a good idea to prevent negative SVG dimensions...
            For example width should be =< margin.left + margin.right + 1,
            of course 1 pixel for the entire chart would not be very useful, BUT should not have errors
            */
        }

        div.DTTT {
            margin-bottom: 0.5em;
            float: right;
        }

        div.dt-buttons {
            margin-bottom: 0.5em;
            float: right;
        }

        div.dataTables_wrapper {
            clear: both;
        }

        #reposrev,
        #forposrev,
        #formaptabular,
        #formaptab2,
        #reposmaptabular,
        #reposmaptab2,
        #posmaptabular,
        #posmaptab2,
        #rtdsurrgraph,
        #rtdsurrgraph2,
        #rtdgentabular,
        #rtdgentab2,
        #rtdmontabular,
        #rtdmontab2 {
            display: none; // you're using display!
        }

        .modal.custom {
            outline:none;

        }

        .modal.custom .modal-dialog {
            width: 100%;
            height: 100%;
            margin: auto;
            /*padding: auto;*/
            overflow: visible;
        }

        .modal.custom .modal-dialog {
            height: auto;
            min-height: 98%;
            /*min-width: 98%;*/
            overflow-y: auto;
            /*border-radius: 0;*/
        }

/*        #chart .c3-line-forecast {
            stroke-width: 5px;
        }
        #chart .c3-line-live-demand {
            stroke-width: 5px;
        }
        #chart .c3-line-live-forecast {
            stroke-width: 3px;
        }
        #chart .c3-line-live-demand-NBPDCL {
            stroke-width: 5px;
        }
        #chart .c3-line-live-forecast-NBPDCL {
            stroke-width: 3px;
        }
        #chart .c3-line-live-demand-SBPDCL {
            stroke-width: 5px;
        }
        #chart .c3-line-live-forecast-SBPDCL {
            stroke-width: 3px;
        }*/
        #chart [class*="c3-line-RT-DEMAND-FORECAST"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

/*        #chart [class*="c3-line-RT-INT-GEN-WIND-FOR"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #chart [class*="c3-line-RT-INT-GEN-SOLAR-FOR"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }*/

        #chart [class*="c3-line-DEMAND-ACTUAL"] {
            stroke-width: 3;
        }

        #chart [class*="c3-line-DB-DEMAND-FORECAST"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
            /*stroke-opacity: 0.6;*/
        }

/*        #chart [class*="c3-line-DB-SOLAR-FORECAST"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #chart [class*="c3-line-DB-WIND-FORECAST"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }*/

        #chart [class*="c3-line-Availibility"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
            stroke-opacity: 0.9;
        }

        #posmapchart [class*="c3-line-10-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #posmapchart [class*="c3-line-1-"] {
            stroke-width: 3;
        }

        #posmapchart [class*="c3-line-31-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
            stroke-opacity: 0.9;
        }

        #posmapchart [class*="c3-line-27-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #posmapchart [class*="c3-line-28-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #posmapchart [class*="c3-line-29-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #posmapchart [class*="c3-line-30-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #posmapchart [class*="c3-line-34-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #posmapchart [class*="c3-line-32-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #posmapchart [class*="c3-line-33-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #reposmapchart [class*="c3-line-27-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #reposmapchart [class*="c3-line-28-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #reposmapchart [class*="c3-line-29-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #reposmapchart [class*="c3-line-30-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #reposmapchart [class*="c3-line-34-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #reposmapchart [class*="c3-line-33-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #reposmapchart [class*="c3-line-19-"] {
            stroke-width: 3;
        }

        #reposmapchart [class*="c3-line-18-"] {
            stroke-width: 3;
        }


        #formapchart [class*="c3-line-1-"] {
            stroke-width: 3;
        }

        #formapchart [class*="c3-line-10-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        #formapchart [class*="c3-line-32-"] {
            stroke-width: 3;
            stroke-dasharray: 3, 3;
        }

        div#aggDiv{
            position:fixed;
            width:100px;
            height:100px;
            /*background:red;*/
            left:10px;
            top:190px;
        }

        .redBlock {
            width: 310px;
            height: 50px;
            background-color: #f5f5f5;
            border: 1px solid #e3e3e3;
            display: inline-block;
        }
    </style>
    <script src="{{ url_for('static', filename='js/knockout-3.4.0.js') }}"></script>
    <script src="{{ url_for('static', filename='js/knockout.mapping.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.tableTools.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.fixedColumns.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.buttons.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/buttons.bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jszip.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/pdfmake.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vfs_fonts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/buttons.html5.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/buttons.print.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap-datepicker.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/require.js') }}"></script>
    <!-- // <script src="{{ url_for('static', filename='js/d3.v3.js') }}"></script> -->
    <!-- // <script src="{{ url_for('static', filename='js/nv.d3.min.js') }}"></script>  -->
    <script src="{{ url_for('static', filename='js/nanobar.min.js') }}"></script>
    <!-- <script src="{{ url_for('static', filename='js/fastpivot.min.js') }}"></script> -->
    <script>
        var quenext_logo = "data:image/png;base64,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";
        ko.bindingHandlers.dataTablesForEach = {
            page: 0,
            init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
              var options = ko.unwrap(valueAccessor());
              ko.unwrap(options.data);
              if(options.dataTableOptions.paging){
              valueAccessor().data.subscribe(function (changes) {
                  var table = $(element).closest('table').DataTable();
                    ko.bindingHandlers.dataTablesForEach.page = table.page();
                    table.destroy();
                }, null, 'arrayChange');
              }
                var nodes = Array.prototype.slice.call(element.childNodes, 0);
                ko.utils.arrayForEach(nodes, function (node) {
                  if (node && node.nodeType !== 1) {
                      node.parentNode.removeChild(node);
                    }
                });
                return ko.bindingHandlers.foreach.init(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext);
            },
            update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
                var options = ko.unwrap(valueAccessor()),
                    key = 'DataTablesForEach_Initialized';
                ko.unwrap(options.data);
                var table;
                if(!options.dataTableOptions.paging){
                  table = $(element).closest('table').DataTable();
                  table.destroy();
                }
                ko.bindingHandlers.foreach.update(element, valueAccessor, allBindings, viewModel, bindingContext);
                table = $(element).closest('table').DataTable(options.dataTableOptions);
                if (options.dataTableOptions.paging) {
                   if (table.page.info().pages - ko.bindingHandlers.dataTablesForEach.page == 0)
                       table.page(--ko.bindingHandlers.dataTablesForEach.page).draw(false);
                   else
                       table.page(ko.bindingHandlers.dataTablesForEach.page).draw(false);
                }
                if (!ko.utils.domData.get(element, key) && (options.data || options.length))
                    ko.utils.domData.set(element, key, true);
                return { controlsDescendantBindings: true };
            }
        };
        /*Spinner parameters*/
        var opts = {
            lines: 13 // The number of lines to draw
                ,
            length: 28 // The length of each line
                ,
            width: 14 // The line thickness
                ,
            radius: 42 // The radius of the inner circle
                ,
            scale: 1 // Scales overall size of the spinner
                ,
            corners: 1 // Corner roundness (0..1)
                ,
            color: '#000' // #rgb or #rrggbb or array of colors
                ,
            opacity: 0.25 // Opacity of the lines
                ,
            rotate: 0 // The rotation offset
                ,
            direction: 1 // 1: clockwise, -1: counterclockwise
                ,
            speed: 1 // Rounds per second
                ,
            trail: 60 // Afterglow percentage
                ,
            fps: 20 // Frames per second when using setTimeout() as a fallback for CSS
                ,
            zIndex: 2e9 // The z-index (defaults to 2000000000)
                ,
            className: 'spinner' // The CSS class to assign to the spinner
                ,
            top: '50%' // Top position relative to parent
                ,
            left: '50%' // Left position relative to parent
                ,
            shadow: false // Whether to render a shadow
                ,
            hwaccel: false // Whether to use hardware acceleration
                ,
            position: 'absolute' // Element positioning
        };

        function LivePosMap(data, cols) {
            var self = this;
            // console.log('LivePosMap', data);
            for (var k in data)
                self[k] = ko.observable(data[k]);

            if (data.hasOwnProperty('INTERNAL_GENERATION_ACTUAL')) {
                self.init_gen = parseFloat(+data['INTERNAL_GENERATION_ACTUAL']);
            };
            if (data.hasOwnProperty('INT_GEN_OTH') && data.hasOwnProperty('INT_GEN_WIND') && data.hasOwnProperty('INT_GEN_SOLAR') && data.hasOwnProperty('INT_GEN_CONV')){
                self.init_gen = parseFloat(+data['INT_GEN_OTH'] || 0) + parseFloat(+data['INT_GEN_CONV'] || 0) +
                parseFloat(+data['INT_GEN_WIND'] || 0) + parseFloat(+data['INT_GEN_SOLAR'] || 0);
            }

            self.init_dem = parseFloat(+data['DEMAND_ACTUAL']);
            if (data.hasOwnProperty('INTERNAL_GENERATION_ACTUAL')) {
                self.int_gen_bias = ko.computed({
                    read: function() {
                        return parseFloat(self.INTERNAL_GENERATION_ACTUAL() - self.init_gen);
                    },
                    write: function(value) {
                        if (value != undefined && !isNaN(parseFloat(value))) {
                            return parseFloat(value) - parseFloat(self.INTERNAL_GENERATION_ACTUAL());
                        }
                    }
                });
            };

            self.dem_bias = ko.computed({
                read: function() {
                    return parseFloat(self.DEMAND_ACTUAL() - self.init_dem);
                },
                write: function(value) {
                    if (value != undefined && !isNaN(parseFloat(value))) {
                        return parseFloat(value) - parseFloat(self.DEMAND_ACTUAL());
                    }
                }
            });

            if (data.hasOwnProperty('LTOA') && !(data.hasOwnProperty('URS'))) {
                self.Availibility = ko.computed(function() {
                    var total = parseFloat(+self.ISGS() || 0) + parseFloat(+self.LTOA() || 0) + parseFloat(+self.MTOA() || 0) + parseFloat(+self.Shared() || 0) + parseFloat(+self.Bilateral() || 0) + parseFloat(+self.INTERNAL_GENERATION_ACTUAL() || +self.RT_INTERNAL_GENERATION_FOR());
                    return total.toFixed(2);
                });
            } else if (data.hasOwnProperty('LTOA_MTOA')) {
                self.Availibility = ko.computed(function() {
                    var total = parseFloat(+self.ISGS() || 0) + parseFloat(+self.LTOA_MTOA() || 0) + parseFloat(+self.Bilateral() || 0) + parseFloat(+self.INTERNAL_GENERATION_ACTUAL() || +self.RT_INTERNAL_GENERATION_FOR());
                    return total.toFixed(2);
                });
            } else if (data.hasOwnProperty('URS') && data.hasOwnProperty('RRAS')) {
                self.Availibility = ko.computed(function() {
                    var total = parseFloat(+self.ISGS() || 0) + parseFloat(+self.LTOA() || 0) + parseFloat(+self.MTOA() || 0) + parseFloat(+self.STOA() || 0) + parseFloat(+self.URS() || 0) + parseFloat(+self.RRAS() || 0) + parseFloat(+self.INT_GEN_OTH() || 0) + parseFloat(+self.INT_GEN_CONV() || 0) +parseFloat(+self.INT_GEN_WIND() || 0) + parseFloat(+self.INT_GEN_SOLAR() || 0);
                    return total.toFixed(2);
                });
            };

            self.Deficit_Surplus = ko.computed(function() {
                var total = parseFloat(+self.DB_DEMAND_FORECAST() || 0) - parseFloat(+self.Availibility() || 0)
                return total.toFixed(2);
            });

            self.Revised_Position = ko.computed(function() {
                var total = parseFloat(+self.Availibility() || 0) - parseFloat(+self.DEMAND_ACTUAL() || +self.RT_DEMAND_FORECAST())
                return total.toFixed(2);
            });

            self.columns = ko.observableArray(cols);
            // console.log('KO2', cols, self.columns());
            self.templateToUse = function(col){
                // console.log('KO3', col, '***templateToUse*');
                if (col.lastIndexOf("ACTUAL") >= 0){
                    return 'write';
                } else {
                    return 'read';
                };
            };
        };

        // var compareObj = function(obj1, obj2) {
        //     var ret = {},rett;
        //     for(var i in obj2) {
        //         rett = {};
        //         if(typeof obj2[i] === 'object'){
        //             rett = compareObj (obj1[i], obj2[i]) ;
        //             if (!$.isEmptyObject(rett) ){
        //               ret[i]= rett
        //             }
        //         }else{
        //             if(!obj1 || !obj1.hasOwnProperty(i) || obj2[i] !== obj1[i]) {
        //                 ret[i] = obj2[i];
        //             }
        //         }
        //     }
        //     return ret;
        // };

         //Main ViewModel
        var LivePosMapViewModel = {
            livepositems: ko.observableArray([]),
            init: [],
            initData: function(){this.init = JSON.parse(ko.toJSON(this.livepositems, null, 2));},
            reset: function(){
                console.log('reseting livemosmap values');
                this.livepositems.removeAll();
                this.load(false);
            },
            save: function(){
                var latest_data = JSON.parse(ko.toJSON(this.livepositems, null, 2));
                console.log('latest_data', latest_data);
                //code for filtering//
                latest_data = $.map(latest_data,function(val,key){
                    if((Number(val.int_gen_bias) && Number(val.int_gen_bias) !== 0 )|| (Number(val.dem_bias) && Number(val.dem_bias) !== 0)){
                        return val;
                    };
                });
                console.log('latest_data filter', latest_data);

                // var compare = compareObj(this.init, latest_data);
                // console.log('length', Object.keys(compare).length);
                // if (Object.keys(compare).length > 0){
                require(["spin"], function(Spinner) {
                    var spinner = new Spinner(opts);
                    $.ajax({
                        url: "{{ url_for('ems.post_liveposmapedit_data') }}",
                        dataType: "json",
                        contentType: 'application/json',
                        type: "POST",
                        data: JSON.stringify({
                            'data': latest_data,
                            'date': $('input[name="date"]').val(),
                            'model': $('#selectmodel').text(),
                            'discom': $('#discomselector').val()
                        }),
                        beforeSend: function(xhr, settings) {
                            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                                var csrftoken = $('meta[name=csrf-token]').attr('content');
                                xhr.setRequestHeader("X-CSRFToken", csrftoken)
                            }
                            console.log("edit liveposedit***beforesend**");
                            var target = document.getElementById('liveposeditModal');
                            spinner.spin(target);
                            // console.log(spinner);
                        },
                        complete: function() {
                            // $("#isgsModal").modal('hide');
                            spinner.stop();
                            LivePosMapViewModel.load();
                        },
                        cache: false,
                        success: function(data) {
                            console.log('success', data);
                            // $.notify("Saved", "success");
                            $.notify({
                                // options
                                icon: 'glyphicon glyphicon-saved',
                                title: "<strong>Live Position Map Status:</strong>",
                                message: 'Saved sucessfully...'
                            },{
                                // settings
                                type: 'success'
                            });
                            update_liveposmap_data();
                        },
                        error: function(errmsg) {
                            console.log('failure', errmsg);
                            // $.notify("Error! Could not save in database", "error");
                            $.notify({
                                // options
                                icon: 'glyphicon glyphicon-warning-sign',
                                title: "<strong>Live Position Map Status:</strong>",
                                message: 'Saving Failed...'
                            },{
                                // settings
                                type: 'error'
                            });
                        }
                    });//ajax end
                });//require end
                // };//if end of compare
            },
            load: function() {
                // console.log('Load function', ForecastViewModel.selectedDate(), $('input[name="date"]').val());
                // console.log('Load function', ForecastViewModel.selectedModel(), $('#selectmodel').val());
                require.config({
                    baseUrl: "{{ url_for('static', filename='js') }}",
                    waitSeconds: 0,
                    paths: {
                        spin: "spin.min"
                    }
                });
                require(["spin"], function(Spinner) {
                    var spinner = new Spinner(opts);
                    $.ajax({
                        url: "{{ url_for('ems.get_liveposmap_data') }}",
                        dataType: "json",
                        contentType: 'application/json',
                        type: "POST",
                        data: JSON.stringify({
                            'date': $('input[name="date"]').val(),
                            'model': $('#selectmodel').text(),
                            'discom': $('#discomselector').val()
                        }),
                        beforeSend: function(xhr, settings) {
                            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                                var csrftoken = $('meta[name=csrf-token]').attr('content');
                                xhr.setRequestHeader("X-CSRFToken", csrftoken)
                            }
                            console.log("get_liveposmap_data***load**");
                            if ($("#rtdmongraph").is(":visible") == true ){
                                var target = document.getElementById('rtdmongraph2');
                            } else {
                                var target = document.getElementById('rtdmontab2');
                            };
                            spinner.spin(target);
                        },
                        complete: function() {
                            console.log("get_liveposmap_data***complete**");
                            spinner.stop();
                        },
                        cache: false,
                        success: function(data) {
                            console.log("get_liveposmap_data***success**", data[0], '***', data[1]);
                            columns = [];
                            for (var i = 0; i < data[1].length; i++) {
                                if (!(data[1][i] === 'State' || data[1][i] === 'Discom' || data[1][i] === 'Revision' || data[1][i] === 'Bias' || data[1][i] === 'INTERNAL_GENERATION')){
                                    columns.push(data[1][i]);
                                };
                            };
                            // console.log("get_liveposmap_data***columns**", columns);
                            rtdposmapdt($('input[name="date"]').val(), data[0], columns);
                            console.log("live_posmap_chart***columns**");
                            live_posmap_chart(data[0], columns);
                            // live_formap_chart(data[0], columns);
                            var LivePosMapData = ko.utils.arrayMap(data[0], function(item) {
                                // console.log("get_liveposmap_data***data**", item);
                                return new LivePosMap(item, columns);
                            });
                            console.log('LivePosMapData', LivePosMapData);
                            LivePosMapViewModel.livepositems(LivePosMapData);
                            LivePosMapViewModel.initData();
                            // livechart(data);
                        }, //success end
                    }); //ajax end
                }); //require end
            } //load end
        }; //LivePosMapViewModel end
        function rtdposmapdt(dateval, data, column){
            var columns = [];
            for (var i = 0; i < column.length; i++) {
                var colobj = {
                    'data': column[i]
                };
                columns.push(colobj);
            };
            console.log("rtdposmapdt**", column);
            console.log("rtdposmapdt**", columns);
            console.log("rtdposmapdt**", data);
            // if ($.fn.dataTable.isDataTable('#rtd')) {
            //     table = $('#rtd').DataTable();
            //     table.destroy();
            //     table.ajax.reload(null, false);
            // };

            var table = $('#rtd').DataTable({
                "scrollY": 404,
                "scrollX": true,
                "scrollCollapse": false,
                // "responsive": true,
                // "paging": true,
                "deferRender": true,
                "lengthMenu": [
                    [96, 80, 64, 48, 32, 16],
                    [96, 80, 64, 48, 32, 16]
                ],
                "iDisplayLength": 96,
                "order": [
                    [0, 'desc'],
                    [1, 'asc'],
                ],
                "data": data,
                "columns": columns,
                "destroy": true,
                // "fixedColumns":{
                //     "leftColumns": 2
                // }
            });
            console.log("rtdposmapdt12**");
            new $.fn.dataTable.Buttons(table, {
                buttons: [{
                    extend: 'csvHtml5',
                    title: 'Quenext_RealTime_' + dateval,
                    customize: function (csv) {
                        var header = '"Quenext"' + ',' + '"Real Time Forecast"' +"\n\n";
                        // console.log('csv:', header + csv);
                        return header +  csv;
                    }
                }, {
                    extend: 'excelHtml5',
                    title: 'Quenext_RealTime_' + dateval,
                    customize: function (xlsx) {
                            // console.log('xlsx:', xlsx);
                            var sheet = xlsx.xl.worksheets['sheet1.xml'];
                            var downrows = 1;
                            var clRow = $('row', sheet);
                            //update Row
                            clRow.each(function () {
                                var attr = $(this).attr('r');
                                var ind = parseInt(attr);
                                ind = ind + downrows;
                                $(this).attr("r",ind);
                            });

                            // Update  row > c
                            $('row c ', sheet).each(function () {
                                var attr = $(this).attr('r');
                                var pre = attr.substring(0, 1);
                                var ind = parseInt(attr.substring(1, attr.length));
                                ind = ind + downrows;
                                $(this).attr("r", pre + ind);
                            });

                            function Addrow(index,data) {
                                msg='<row r="'+index+'">'
                                for(i=0;i<data.length;i++){
                                    var key=data[i].k;
                                    var value=data[i].v;
                                    msg += '<c t="inlineStr" r="' + key + index + '" s="2">';
                                    msg += '<is>';
                                    msg +=  '<t>'+value+'</t>';
                                    msg+=  '</is>';
                                    msg+='</c>';
                                }
                                msg += '</row>';
                                return msg;
                            }

                            //insert
                            var r1 = Addrow(1, [{ k: 'A', v: 'Quenext' }, { k: 'B', v: '' }, { k: 'C', v: 'Real Time Forecast' }]);
                            // var r2 = Addrow(2, [{ k: 'A', v: '' }, { k: 'B', v: 'ColB' }, { k: 'C', v: '' }]);
                            // var r3 = Addrow(3, [{ k: 'A', v: '' }, { k: 'B', v: '' }, { k: 'C', v: 'ColC' }]);
                            // var img = document.createElement('img');
                            // img.src = "{{ url_for('static', filename='images/logo_large-Gray.png') }}";
                            // console.log(img.src);
                            sheet.childNodes[0].childNodes[1].innerHTML = r1 + sheet.childNodes[0].childNodes[1].innerHTML;
                        }
                }, {
                    extend: 'pdfHtml5',
                    title: 'Quenext_RealTime_' + dateval,
                    customize: function ( doc ) {
                        // Splice the image in after the header, but before the table
                        doc.content.splice( 0, 0, {
                            margin: [ 0, 0, 0, 5 ],
                            alignment: 'center',
                            image: quenext_logo,
                            // Data URL generated by http://dataurl.net/#dataurlmaker
                            width: 100,
                            height: 29
                        });
                    }
                }, {
                    extend: 'print',
                    title: 'Quenext_RealTime_' + dateval
                }, ]
            });
            table.buttons().container(0, null)
                .insertBefore('div#rtd_wrapper.dataTables_wrapper');
        };

        function live_posmap_chart(data, cols){
            console.log('live_posmap_chart', data);
            console.log('live_posmap_chart cols', cols);
            var chartcolumns = [];
            var gropupcolumns = [];
            var excludevar = ['Deficit_Surplus', 'Date', 'INTERNAL_GENERATION_ACTUAL', 'RT_INTERNAL_GENERATION_FOR',
                'RT_INT_GEN_WIND_FOR', 'RT_INT_GEN_SOLAR_FOR', 'DB_WIND_FORECAST', 'DB_SOLAR_FORECAST'];
            for (var i = 0; i < cols.length; i++) {
                // if (!(cols[i] === 'Deficit_Surplus' || cols[i] === 'Date' || cols[i] === 'INTERNAL_GENERATION_ACTUAL' || cols[i] === 'RT_INTERNAL_GENERATION_FOR' || )){
                //     chartcolumns.push(cols[i]);
                // };
                if (excludevar.indexOf(cols[i]) === -1) {
                    chartcolumns.push(cols[i]);
                };
                if (cols.indexOf("LTOA_MTOA") !== -1) {
                    // gropupcolumns = ['RT_INTERNAL_GENERATION_FOR', 'ISGS', 'LTOA_MTOA', 'Bilateral', 'IEX', 'PXIL'];
                    gropupcolumns = ['INTERNAL_GENERATION', 'ISGS', 'LTOA_MTOA', 'Bilateral', 'IEX', 'PXIL'];
                } else if (cols.indexOf("URS") !== -1) {
                    // gropupcolumns = ['RT_INTERNAL_GENERATION_FOR', 'ISGS', 'LTOA', 'MTOA', 'Shared', 'Bilateral', 'IEX', 'PXIL'];
                    gropupcolumns = ['INT_GEN_OTH', 'INT_GEN_CONV', 'INT_GEN_WIND', 'INT_GEN_SOLAR', 'ISGS', 'LTOA', 'MTOA', 'STOA', 'URS', 'RRAS', 'IEX', 'PXIL'];
                } else  {
                    gropupcolumns = ['INTERNAL_GENERATION', 'ISGS', 'LTOA', 'MTOA', 'Shared', 'Bilateral', 'IEX', 'PXIL'];
                };
            };
            console.log('gropupcolumns cols', gropupcolumns);
            console.log('chartcolumns cols', chartcolumns);
            require.config({
                baseUrl: "{{ url_for('static', filename='js') }}",
                waitSeconds: 0,
                paths: {
                    d3: "d3.min",
                    c3: "c3.min"
                }
            });//require end

            require(["d3", "c3"], function(d3, c3) {
                var chart = c3.generate({
                    bindto: "#chart",
                    size: {
                        height: 480,
                        width: 960 + 150
                    },
                    padding: {
                        // top: 30,
                        // bottom: 20
                    },
                    data: {
                        json: data,
                        keys: {
                            x: 'Block_No',
                            value: chartcolumns
                        },
                        type: "area-spline",
                        types: {
                            'RT_DEMAND_FORECAST': 'line',
                            // 'RT_INT_GEN_WIND_FOR': 'line',
                            // 'RT_INT_GEN_SOLAR_FOR': 'line',
                            'DEMAND_ACTUAL': 'line',
                            'DB_DEMAND_FORECAST': 'line',
                            // 'DB_WIND_FORECAST': 'line',
                            // 'DB_SOLAR_FORECAST': 'line',
                            'Availibility': 'line',
                            'Revised_Position': 'bar'
                        },
                        groups: [gropupcolumns],
                        colors: {
                            'DB_DEMAND_FORECAST': '#756bb1',
                            // 'RT_INT_GEN_WIND_FOR': '#2ca02c',
                            // 'RT_INT_GEN_SOLAR_FOR': '#98df8a',
                            'DEMAND_ACTUAL': '#daa520',
                            'RT_DEMAND_FORECAST': '#e31a1c',
                            'Availibility': "#7f7f7f",
                            // 'DB_WIND_FORECAST': "#80ced6",
                            // 'DB_SOLAR_FORECAST': "#f18973"
                        },
                        axes: {},
                        labels: false,
                        // regions: {
                        //     RT_DEMAND_FORECAST: [{'start':1, 'end':96, 'style': 'dashed'}]
                        // },
                        empty: {
                            label: {
                                text: "No Data"
                            }
                        },
                    },
                    axis: {
                        x: {
                            //    type: 'categorized'
                            label: {
                                text: 'Block No',
                                position: 'outer-center'
                            },
                            height: 80,
                            tick: {
                                fit: true,
                                width: 20,
                                // rotate: 75,
                                // count: 96 * 4,
                                // format: function(x) {
                                //     var zero = d3.format("02d");
                                //     return zero(x) + ' ' + zero(Math.floor(x / 4)) + 'h'
                                // },
                                culling: {
                                    max: 48
                                }
                                // values: [0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 68, 72, 76, 80, 84, 88, 92, 96, 24],
                                // multiline: true

                            }
                        },
                        y: {
                            label: {
                                text: 'Quantum (MW)',
                                position: 'outer-middle'
                            },
                            padding: {
                                top: 2,
                                bottom: 3
                            },
                        }
                    },
                    grid: {
                        y: {
                            show: true
                        },
                        x: {
                            show: true
                        },
                        focus: {
                            show: true
                        }
                    },
                    legend: {
                        //position: 'right',
                        show: true
                    },
                    point: {
                        show: false
                    },
                    transition: {
                        duration: 100
                    },
                    tooltip: {
                        format: {
                            title: function(d) {
                                timestrfmt = d3.format("02d");
                                return 'Block_No ' + d +
                                    ' Time ' + timestrfmt(Math.floor(d * 15 / 60)) + ':' + (timestrfmt(((d * 15 / 60) - Math.floor(d * 15 / 60)) * 60));
                            }
                        }
                    },
                    regions: [
                        {axis: 'x', start: 21, end: 31},
                        {axis: 'x', start: 73, end: 92}
                    ],
                    color: {
                        // pattern: classic9
                        // patttern: [
                        //             '#ecb796',
                        //             '#dc8f70',
                        //             '#b2a470',
                        //             '#92875a',
                        //             '#716c49',
                        //             '#d2ed82',
                        //             '#bbe468',
                        //             '#a1d05d',
                        //             '#e7cbe6',
                        //             '#d8aad6',
                        //             '#a888c2',
                        //             '#9dc2d3',
                        //             '#649eb9',
                        //             '#387aa3'
                        //           ]
                        // pattern: ['#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c','#fdbf6f','#ff7f00','#cab2d6','#6a3d9a','#ffff99','#b15928']
                        pattern : ['#1f77b4', '#aec7e8', '#ff7f0e', '#ffbb78', '#2ca02c', '#98df8a', '#ff9896', '#9467bd', '#c5b0d5', '#8c564b', '#c49c94', '#f7b6d2', '#7f7f7f', '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5']
                        // pattern: ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac"]
                    },
                    zoom: {
                        enabled: true,
                        rescale: true,
                        extent: [1, 100]
                    }
                });//end chart
            });//end require
        }; //live_posmap_chart ends;

        function live_formap_chart(data, cols){
            console.log('live_formap_chart', data);
            console.log('live_formap_chart cols', cols);
            var chartcolumns = [];
            // gropupcolumns = [];
            for (var i = 0; i < cols.length; i++) {
                if (cols[i] === 'RT_DEMAND_FORECAST' || cols[i] === 'DEMAND_ACTUAL' || cols[i] === 'DB_DEMAND_FORECAST' || cols[i] === 'Block_No'){
                    chartcolumns.push(cols[i]);
                };
            };
            console.log('live_formap_chart cols', chartcolumns);
            require.config({
                baseUrl: "{{ url_for('static', filename='js') }}",
                waitSeconds: 0,
                paths: {
                    d3: "d3.min",
                    c3: "c3.min"
                }
            });//require end

            require(["d3", "c3"], function(d3, c3) {
                var forchart = c3.generate({
                    bindto: "#formapchart",
                    size: {
                        height: 480,
                        width: 960 + 150
                    },
                    padding: {
                        // top: 30,
                        // bottom: 20
                    },
                    data: {
                        json: data,
                        keys: {
                            x: 'Block_No',
                            value: chartcolumns
                        },
                        type: "area-spline",
                        types: {
                            'RT_DEMAND_FORECAST': 'line',
                            'DEMAND_ACTUAL': 'line',
                            'DB_DEMAND_FORECAST': 'line'
                        },
                        groups: [],
                        colors: {
                            'DB_DEMAND_FORECAST': '#000000',
                            'DEMAND_ACTUAL': '#e31a1c',
                            'RT_DEMAND_FORECAST': '#86af49'
                        },
                        axes: {},
                        labels: false,
                        // regions: {
                        //     RT_DEMAND_FORECAST: [{'start':1, 'end':96, 'style': 'dashed'}]
                        // },
                        empty: {
                            label: {
                                text: "No Data"
                            }
                        },
                    },
                    axis: {
                        x: {
                            //    type: 'categorized'
                            label: {
                                text: 'Block No',
                                position: 'outer-center'
                            },
                            height: 80,
                            tick: {
                                fit: true,
                                width: 20,
                                // rotate: 75,
                                // count: 96 * 4,
                                // format: function(x) {
                                //     var zero = d3.format("02d");
                                //     return zero(x) + ' ' + zero(Math.floor(x / 4)) + 'h'
                                // },
                                culling: {
                                    max: 48
                                }
                                // values: [0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 68, 72, 76, 80, 84, 88, 92, 96, 24],
                                // multiline: true

                            }
                        },
                        y: {
                            label: {
                                text: 'Quantum (MW)',
                                position: 'outer-middle'
                            },
                            padding: {
                                top: 2,
                                bottom: 3
                            },
                        }
                    },
                    grid: {
                        y: {
                            show: true
                        },
                        x: {
                            show: true
                        },
                        focus: {
                            show: true
                        }
                    },
                    legend: {
                        //position: 'right',
                        show: true
                    },
                    point: {
                        show: false
                    },
                    transition: {
                        duration: 100
                    },
                    tooltip: {
                        format: {
                            title: function(d) {
                                timestrfmt = d3.format("02d");
                                return 'Block_No ' + d +
                                    ' Time ' + timestrfmt(Math.floor(d * 15 / 60)) + ':' + (timestrfmt(((d * 15 / 60) - Math.floor(d * 15 / 60)) * 60));
                            }
                        }
                    },
                    regions: [
                        // {axis: 'x', start: 21, end: 31},
                        // {axis: 'x', start: 73, end: 92}
                    ],
                    color: {
                        pattern : ['#1f77b4', '#aec7e8', '#ff7f0e', '#ffbb78', '#2ca02c', '#98df8a', '#ff9896', '#9467bd', '#c5b0d5', '#8c564b', '#c49c94', '#f7b6d2', '#7f7f7f', '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5']

                    },
                    zoom: {
                        enabled: true,
                        rescale: true,
                        extent: [1, 100]
                    }
                });//end forchart
            });//end require
        }; //live_formap_chart ends;

        function ModelDropDown(type){
            var modeldata = {{ model_name|tojson|safe }};
            console.log('modeldata', modeldata, type);
            var model_items = [];
            $.each(modeldata, function(idx, obj){
                $.each(obj, function(key, val){
                    if (type === "Demand") {
                        if (key === 'model_type' && val === 'SINK'){
                            // model_items.push( "<li><a href='#' data-value='" + obj['model_short_name'] + "'>" + obj['model_short_name'] + "</li>" );
                            model_items.push( '<li onclick="onChangeModel(\'' + obj['model_short_name'] + '\')"><a href="#" value="' + obj['model_short_name'] + '">' + obj['model_short_name'] + '</li>' );
                        };
                    } else if (type === "Generation") {
                        if (key === 'model_type' && val === 'INJECTION'){
                            model_items.push( '<li onclick="onChangeModel(\'' + obj['model_short_name'] + '\')"><a href="#" value="' + obj['model_short_name'] + '">' + obj['model_short_name'] + '</li>' );
                        };
                    };
                });
            });
            console.log('model_items', model_items);
            // var data = {{ def_model_mrr|tojson|safe }};
            var data = livedefaultvalues.data;
            var def_items = {};
            $.each(data, function(idx, obj){
                $.each(obj, function(key, val){
                    if (key === "type" && val === type) {
                        console.log('set model def based on type: ', type, val, obj['model_short_name']);
                        def_items = obj;
                        selectedModel =  obj['model_short_name'];
                        def_mrr =  obj['mrr'];
                    };
                });
            });
            $('#selectmodel span').remove(".selection, .caret");
            $('#selectmodel_list').remove();
            $("<span/>", {
                "class": "selection",
                "id": "lbl_selectmodel",
                html: [def_items['model_short_name']].join( "" )
            }).appendTo( "#selectmodel" );
            $("<span/>", {
                "class": "caret",
                html: ""
            }).appendTo( "#selectmodel" );
            $( "<ul/>", {
               "class": "dropdown-menu",
               "aria-labelledby": "selectmodel",
               "id": "selectmodel_list",
               html: model_items.join( "" )
            }).insertAfter( "#selectmodel" );
            $( '#input-mrr' ).val(def_mrr);

        };

        function LiveDropDownChange(data){
            console.log('data', data);
            selectedType = null;
            selectedModel = null;
            // var data = {{ def_model_mrr|tojson|safe }};
            var type_items = [];
            var def_items = {};
            $.each(data, function(idx, obj){
                $.each(obj, function(key, val){
                    if (key === "type") {
                        // type_items.push( '<li onclick="onChangeType(\'' + val + '\',\'' + JSON.stringify(data) + '\')"><a href="#" value="' + val + '">' + val + '</li>' );
                        type_items.push( '<li onclick="onChangeType(\'' + val + '\')"><a href="#" value="' + val + '">' + val + '</li>' );
                        selectedType = val;
                        def_items = obj;
                    };
                });
            });
            $('#type_dropdown span').remove(".selection, .caret");
            $("<span/>", {
                "class": "selection",
                "id": "lbl_selecttype",
                html: [def_items['type']].join( "" )
            }).appendTo( "#type_dropdown" );
            $("<span/>", {
                "class": "caret",
                html: ""
            }).appendTo( "#type_dropdown" );
            console.log(type_items);
            $( "<ul/>", {
               "class": "dropdown-menu",
               "aria-labelledby": "type_dropdown",
               html: type_items.join( "" )
            }).insertAfter( "#type_dropdown" );
            ModelDropDown(def_items['type']);
            $("input-mrr").val(def_items['mrr']);
        };

        var livedefaultvalues = {
            data: [],
            load: function(){
                    $.ajax({
                        url: "def_mrr_model_values/" + $('input[name="date"]').val(),
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        // type: "POST",
                        // data: JSON.stringify({
                        //     'date': $('input[name="date"]').val(),
                        //     'model': $('#selectmodel').text(),
                        //     'discom': $('#discomselector').val(),
                        //     'mrr': +$('#input-mrr').val(),
                        //     'type': $('#type_dropdown').text()
                        // }),
                        beforeSend: function(xhr, settings) {
                            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                                var csrftoken = $('meta[name=csrf-token]').attr('content');
                                xhr.setRequestHeader("X-CSRFToken", csrftoken)
                            }
                            console.log("livedefaultvalues***load**");
                            // spinner.spin(target);
                        },
                        complete: function() {
                            console.log("livedefaultvalues***complete**");
                            // spinner.stop();
                        },
                        cache: false,
                        success: function(data) {
                            console.log("livedefaultvalues***success**", data);
                            livedefaultvalues.data = data;
                            LiveDropDownChange(data);
                        }, //success end
                    }); //ajax end
                }
        };

        function onChangeType(Value){
            if ((Value != undefined) && (Value != null) && (Value != '')){
                if (selectedType != Value){
                    ModelDropDown(Value);
                    selectedType = Value;
                    $('#lbl_selecttype').val(Value);
                    $('#lbl_selecttype').text(Value);
                };
            };
        };

        function onChangeModel(Value){
            if ((Value != undefined) && (Value != null) && (Value != '')){
                if (selectedModel != Value){
                    console.log('oldvalue: ', selectedModel, ' newvalue: ',  Value);
                    selectedModel = Value;
                    $('#lbl_selectmodel').val(Value);
                    $('#lbl_selectmodel').text(Value);
                    // update_liveposmap_data();
                };
            };
        };

        function DoValidate(){
            // check your validate here,
            // if all field pass: return true, if not : return false;
            // ex: return $('input[name="part_barcode"]).val().length>10;
            // alert($('input[name="model"]').val().length);
            // alert($('input[name="date"]').val().length);
            return $('input[name="date"]').val() != "";
            // return true;
        };

        var myVar;
        function myTimer() {
            var d = new Date();
            console.log('Date: ', d);
            livedefaultvalues.load();
            LivePosMapViewModel.load();
        };

        function calldovalidate(){
            if(DoValidate()){
                switch ($('.nav-tabs .active > a').attr('href')) {
                    case "#rtdmontab":
                        console.log('DoValidate rtdmontab');
                        // $('#selectmodel').show();
                        // $('#inputgr-mrr').show();
                        $('#type_mrr_model').show();
                        $('#update_mrr_model').show();
                        $('#aggDiv').hide();
                        $('#reposrev').hide();
                        $('#forposrev').hide();
                        LivePosMapViewModel.load();
                        // Stoppped my Timer from auto refreshing
                        // myVar = setInterval(myTimer, 980000);
                        // setInterval(myTimer(), 1000);
                        // setInterval(LivePosMapViewModel.load(), 10000);
                        // livechart($('input[name="date"]').val());
                        /*setTimeout is used so as to execute the faster async request*/
                        // setTimeout(function() {
                        //     rtdposmap($('input[name="date"]').val());
                        // }, 10);
                        break;
                    case "#rtdsurrtab":
                        console.log('DoValidate rtdsurrtab');
                        // $('#selectmodel').show();
                        // $('#inputgr-mrr').show();
                        $('#type_mrr_model').hide();
                        $('#update_mrr_model').hide();
                        $('#aggDiv').hide();
                        $('#reposrev').hide();
                        $('#forposrev').hide();
                        // rtdsurrender($('input[name="date"]').val());
                        rtd_surr_rev($('input[name="date"]').val(), $('#discomselector').val());
                        clearInterval(myVar);
                        break;
                    case "#rtdgentab":
                        console.log('DoValidate rtdgentab');
                        // $('#selectmodel').hide();
                        // $('#inputgr-mrr').hide();
                        $('#type_mrr_model').hide();
                        $('#update_mrr_model').hide();
                        $('#aggDiv').hide();
                        $('#reposrev').hide();
                        $('#forposrev').hide();
                        rtd_gen_data($('input[name="date"]').val());
                        // genstackgraph($('input[name="date"]').val());
                        // setTimeout(function() {
                        //     rtd_gen_data($('input[name="date"]').val());
                        // }, 10);
                        clearInterval(myVar);
                        break;
                    case "#posmaptab":
                        console.log('DoValidate posmaptab');
                        $('#type_mrr_model').show();
                        $('#update_mrr_model').show();
                        $('#aggDiv').show();
                        $('#reposrev').hide();
                        $('#forposrev').hide();
                        get_posmap_data($('input[name="date"]').val(), $('#discomselector').val(), $('#aggLevel').val());
                        break;
                    case "#reposmaptab":
                        console.log('DoValidate reposmaptab');
                        $('#type_mrr_model').show();
                        $('#update_mrr_model').show();
                        $('#aggDiv').show();
                        $('#reposrev').show();
                        $('#forposrev').hide();
                        get_posmap_data($('input[name="date"]').val(), $('#discomselector').val(), $('#aggLevel').val());
                        break;
                    case "#formaptab":
                        console.log('DoValidate formaptab');
                        $('#type_mrr_model').show();
                        $('#update_mrr_model').show();
                        $('#aggDiv').show();
                        $('#reposrev').hide();
                        $('#forposrev').show();
                        get_posmap_data($('input[name="date"]').val(), $('#discomselector').val(), $('#aggLevel').val());
                        break;
                    default:
                        console.log('DoValidate default');
                        // $('#selectmodel').hide();
                        // $('#inputgr-mrr').hide();
                        $('#type_mrr_model').hide();
                        $('#update_mrr_model').hide();
                        $('#aggDiv').hide();
                        $('#reposrev').hide();
                        $('#forposrev').hide();
                        clearInterval(myVar);
                        break;
                };
                livedefaultvalues.load();
            };
        };


        function update_liveposmap_data(callback){
            require.config({
                baseUrl: "{{ url_for('static', filename='js') }}",
                waitSeconds: 0,
                paths: {
                    spin: "spin.min"
                }
            });
            if ((+$('#input-mrr').val() >= 0) && (+$('#input-mrr').val() <= 1) && ($('#input-mrr').val() !== "")) {
                require(["spin"], function(Spinner) {
                    var spinner = new Spinner(opts);
                    $.ajax({
                        url: "{{ url_for('ems.update_liveposmap_data') }}",
                        dataType: "json",
                        contentType: 'application/json',
                        type: "POST",
                        data: JSON.stringify({
                            'date': $('input[name="date"]').val(),
                            'model': $('#selectmodel').text(),
                            'discom': $('#discomselector').val(),
                            'mrr': +$('#input-mrr').val(),
                            'type': $('#type_dropdown').text()
                        }),
                        beforeSend: function(xhr, settings) {
                            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                                var csrftoken = $('meta[name=csrf-token]').attr('content');
                                xhr.setRequestHeader("X-CSRFToken", csrftoken)
                            }
                            console.log("update_liveposmap_data***load**");
                            // spinner.spin(target);
                        },
                        complete: function() {
                            console.log("update_liveposmap_data***complete**");
                            // spinner.stop();
                        },
                        cache: false,
                        success: function(data, status, request) {
                            console.log("update_liveposmap_data***success**", data);
                            status_url = request.getResponseHeader('Location');
                            // status(status_url);
                            console.log("update_liveposmap_data***status_url**", status_url);
                            update_progress_no_bar(status_url, callback);
                        }, //success end
                    }); //ajax end
                }); //require end
            };// if end
        };

        // Returns a function, that, as long as it continues to be invoked, will not
        // be triggered. The function will be called after it stops being called for
        // N milliseconds. If `immediate` is passed, trigger the function on the
        // leading edge, instead of the trailing.
        function debounce(func, wait, immediate) {
            var timeout;
            return function() {
                var context = this, args = arguments;
                var later = function() {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                };
                var callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
            };
        };

        function rtd_surr_rev(dateval, discom) {
            console.log('rtd_surr_rev', dateval, discom);
            require.config({
                baseUrl: "{{ url_for('static', filename='js') }}",
                waitSeconds: 0,
                paths: {
                    spin: "spin.min"
                }
            });
            require(['spin'], function(Spinner) {
                var spinner = new Spinner(opts);
                if (document.getElementById('rtdsurrgraph2').style.display !== ""){
                    var target = document.getElementById('rtdsurrgraph2');
                } else {
                    var target = document.getElementById('surrender');
                }
                $.ajax({
                    url: "{{ url_for('ems.get_surrender_revival_data') }}",
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        'date': dateval,
                        'discom': discom
                    }),
                    beforeSend: function(xhr, settings) {
                        var csrftoken = $('meta[name=csrf-token]').attr('content');
                        if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken)
                        }
                        spinner.spin(target);
                        dt = new Date();
                        console.log(dt + "rtd_surr_rev***beforesend**" + dateval);
                    },
                    complete: function() {
                        console.log(dt + "rtd_surr_rev***complete**" + dateval);
                        spinner.stop();
                    },
                    dataFilter: function(data) {
                        // console.log('dataFilter', data);
                        return data;
                    },
                    cache: false,
                    success: function(data) {
                        spinner.spin(target);
                        console.log(data);
                        surr_rev_data_pivot(data, dateval);
                        console.log('rtd_surr_rev success');
                        spinner.stop();
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(textStatus);
                        spinner.stop();
                    }
                });
            });
        };


        function surr_rev_data_pivot(data, dateval){
            console.log('alloc_opt_data_pivot', data);
            var UniqueNames = $.unique(data.map(function(d) {
                return d.generator_name;
            }));
            var newdata = [];
            var total = 0;
            var old_block_no = -99;
            for (var i = 0; i < data.length; i++) {
                var j = data[i]['block_no'];
                if (old_block_no != j) {
                    if (i > 0) {
                        // console.log(i, newobj);
                        newobj['Total'] = Math.round(total);
                        total = 0;
                        newdata[old_block_no - 1] = newobj;
                    };
                    newobj = {};
                    newobj['Date'] = data[i]['date'];
                    newobj['Block_No'] = data[i]['block_no'];
                    for (var s in UniqueNames) {
                        // console.log(s, data[j]['Station_Name']);
                        if (data[i]['generator_name'] == UniqueNames[s]) {
                            // console.log(s, UniqueNames[s], i);
                            newobj[UniqueNames[s]] = Math.round(data[i]['quantum']);
                            total += newobj[UniqueNames[s]];
                        } else {
                            newobj[UniqueNames[s]] = 0;
                            total += newobj[UniqueNames[s]];
                        };
                    };
                } else if (old_block_no == j) {
                    for (var s in UniqueNames) {
                        if (data[i]['generator_name'] == UniqueNames[s]) {
                            newobj[UniqueNames[s]] = Math.round(newobj[UniqueNames[s]] + data[i]['quantum']);
                            total += newobj[UniqueNames[s]];
                        };
                    };
                }
                // console.log('total', i, j, data[i]['generator_name'], total);
                old_block_no = j;
                if (i == data.length - 1) {
                    newobj['Total'] = Math.round(total);
                    newdata[old_block_no - 1] = newobj;
                    break;
                };
            };
            console.log('surrender newdata', newdata);
            $('#surrender').empty();
            if (newdata.length) {
                if ($.fn.dataTable.isDataTable('#surrender')) {
                    table = $('#surrender').DataTable();
                    table.destroy();
                    // table.ajax.reload( null, false );
                }
                // var columns = [{'data':'Date'}, {'data':'Block_No'}];
                // for (var i in UniqueNames){
                //   // console.log('i',i, UniqueNames[i]);
                //   var colobj = {'data': UniqueNames[i]};
                //   columns.push(colobj);
                // };
                var columns = [];
                var newTable = '<thead><tr>';
                $.each(newdata[0], function(key, value) {
                    var colobj = {
                        'data': key
                    };
                    columns.push(colobj);
                    newTable += "<th>" + key + "</th>";
                });
                newTable += "</tr></thead>";
                $('#surrender').html(newTable);

                // console.log('tbody****', newTable);
                // console.log('columns', columns);
                var table = $('#surrender').DataTable({
                    "scrollY": 404,
                    "scrollX": true,
                    "scrollCollapse": true,
                    //"responsive": true,
                    "paging": true,
                    "deferRender": true,
                    "lengthMenu": [
                        [96, 80, 64, 48, 32, 16],
                        [96, 80, 64, 48, 32, 16]
                    ],
                    "iDisplayLength": 96,
                    "order": [
                        [0, 'asc'],
                        [1, 'asc']
                    ],
                    "data": newdata,
                    "columns": columns,
                });
                new $.fn.dataTable.Buttons(table, {
                    // buttons: ['csv', 'excel', 'pdf', 'print']
                    buttons: [{
                        extend: 'csvHtml5',
                        title: 'Quenext_Surrender_' + dateval,
                        customize: function (csv) {
                            var header = '"Quenext"' + ',' + '"Real Time Surrender"' +"\n\n";
                            // console.log('csv:', header + csv);
                            return header +  csv;
                        }
                    }, {
                        extend: 'excelHtml5',
                        title: 'Quenext_Surrender_' + dateval,
                        customize: function (xlsx) {
                                // console.log('xlsx:', xlsx);
                                var sheet = xlsx.xl.worksheets['sheet1.xml'];
                                var downrows = 1;
                                var clRow = $('row', sheet);
                                //update Row
                                clRow.each(function () {
                                    var attr = $(this).attr('r');
                                    var ind = parseInt(attr);
                                    ind = ind + downrows;
                                    $(this).attr("r",ind);
                                });

                                // Update  row > c
                                $('row c ', sheet).each(function () {
                                    var attr = $(this).attr('r');
                                    var pre = attr.substring(0, 1);
                                    var ind = parseInt(attr.substring(1, attr.length));
                                    ind = ind + downrows;
                                    $(this).attr("r", pre + ind);
                                });

                                function Addrow(index,data) {
                                    msg='<row r="'+index+'">'
                                    for(i=0;i<data.length;i++){
                                        var key=data[i].k;
                                        var value=data[i].v;
                                        msg += '<c t="inlineStr" r="' + key + index + '" s="2">';
                                        msg += '<is>';
                                        msg +=  '<t>'+value+'</t>';
                                        msg+=  '</is>';
                                        msg+='</c>';
                                    }
                                    msg += '</row>';
                                    return msg;
                                }

                                //insert
                                var r1 = Addrow(1, [{ k: 'A', v: 'Quenext' }, { k: 'B', v: '' }, { k: 'C', v: 'Real Time Surrender' }]);
                                // var r2 = Addrow(2, [{ k: 'A', v: '' }, { k: 'B', v: 'ColB' }, { k: 'C', v: '' }]);
                                // var r3 = Addrow(3, [{ k: 'A', v: '' }, { k: 'B', v: '' }, { k: 'C', v: 'ColC' }]);
                                // var img = document.createElement('img');
                                // img.src = "{{ url_for('static', filename='images/logo_large-Gray.png') }}";
                                // console.log(img.src);
                                sheet.childNodes[0].childNodes[1].innerHTML = r1 + sheet.childNodes[0].childNodes[1].innerHTML;
                            }
                    }, {
                        extend: 'pdfHtml5',
                        title: 'Quenext_Surrender_' + dateval,
                        customize: function ( doc ) {
                            // Splice the image in after the header, but before the table
                            doc.content.splice( 0, 0, {
                                margin: [ 0, 0, 0, 5 ],
                                alignment: 'center',
                                image: quenext_logo,
                                // Data URL generated by http://dataurl.net/#dataurlmaker
                                width: 100,
                                height: 29
                            });
                        }
                    }, {
                        extend: 'print',
                        title: 'Quenext_Surrender_' + dateval
                    }]
                });
                table.buttons().container(0, null)
                    .insertBefore('div#surrender_wrapper.dataTables_wrapper');
                if (document.getElementById('rtdsurrgraph2').style.display !== ""){
                    console.log('Inside surr_rev_data_pivot');
                    surr_rev_graph(newdata, UniqueNames);
                }
            } else {
                console.log('surr_rev_data_pivot in else');
                if ($.fn.dataTable.isDataTable('#surrender')) {
                    console.log('surr_rev_data_pivot in else in if');
                    table = $('#surrender').DataTable();
                    table.destroy();
                    $('#surrender').empty();
                    // table.ajax.reload( null, false );
                }
            };
        };

        function surr_rev_graph(data, UniqueNames) {
            // function d3cht(data){
            requirejs.config({
                baseUrl: "{{ url_for('static', filename='js') }}"
            });

            require(["d3"], function(d3) {
                console.log(d3.version);
                // console.log(nv.version);
                // console.log(Object.keys(data).length);
                // console.log('bnested', data);
                console.log('surr_rev_graph UniqueNames', UniqueNames);

                var arr = []
                var sortednames = UniqueNames.sort();
                console.log('surr_rev_graph UniqueNames', UniqueNames);
                data.forEach(function(item) {
                    sortednames.forEach(function(name) {
                        arr.push({
                            "Date": item.Date,
                            "x": item.Block_No,
                            "y": item[name],
                            "Station_Name": name
                        });
                    });
                });
                console.log('surrarr', arr);
                // var nested_data = [];
                // for (var s in UniqueNames){
                //     x = d3.nest()
                //       .key(function(d) {
                //             return UniqueNames[s];
                //           })
                //       .entries(data);
                //   nested_data.push(x[0]);
                // };
                var nested_data = d3.nest()
                    .key(function(d) {
                        return d.Station_Name;
                    })
                    .entries(arr);
                // console.log('nesteed', nested_data);
                require(["nv.d3.min"], function(nv) {
                    nv = window.nv;
                    console.log(nv.version);
                    nv.addGraph(function() {
                        var chart = nv.models.multiBarChart()
                            .groupSpacing(0.1).stacked(true);
                        // .height(600);
                        //           .options({
                        //     transitionDuration: 300,
                        //     useInteractiveGuideline: true
                        // });
                        // chart.reduceXTicks(false).staggerLabels(true);
                        chart.xAxis.axisLabel("Block No").tickFormat(d3.format(',d'));
                        chart.yAxis
                            // .axisLabelDistance(35)
                            // .showMaxMin(false)
                            .axisLabel('Surrender (MW)')
                            .tickFormat(d3.format('d'));

                        d3.select('#surrchart svg')
                            .datum(nested_data)
                            .transition().duration(500)
                            .call(chart);

                        nv.utils.windowResize(chart.update);

                        return chart;
                    });
                });
            });
            // };
        };

        // function rtdsurrender(dateval) {
        //     console.log("rtdsurrender");
        //     if ($.fn.dataTable.isDataTable('#surrender')) {
        //         table = $('#surrender').DataTable();
        //         console.log("rtdsurrender:" + table);
        //         table.destroy();
        //         table.ajax.reload(null, false);
        //         console.log("rtdsurrender");
        //     };

        //     var table = $('#surrender').DataTable({
        //         "scrollY": 404,
        //         // "scrollX": true,
        //         // "scrollCollapse": true,
        //         //"responsive": true,
        //         // "paging": true,
        //         "deferRender": true,
        //         "lengthMenu": [
        //             [96, 80, 64, 48, 32, 16],
        //             [96, 80, 64, 48, 32, 16]
        //         ],
        //         "iDisplayLength": 96,
        //         "order": [
        //             [0, 'desc'],
        //             [1, 'desc'],
        //             [2, 'desc'],
        //             [3, 'asc']
        //         ],
        //         "ajax": {
        //             "url": "{{ url_for('ems.get_surrender_revival_data') }}",
        //             "type": "POST",
        //             "data": function(d) {
        //                 d.date = dateval;
        //                 d.discom = $('#discomselector').val();
        //             }
        //         },
        //         // "fixedColumns":{
        //         //     "leftColumns": 2
        //         // }
        //     });

        //     new $.fn.dataTable.Buttons(table, {
        //         // buttons: ['csv', 'excel', 'pdf', 'print']
        //         buttons: [{
        //             extend: 'csvHtml5',
        //             title: 'Surrender_' + dateval
        //         }, {
        //             extend: 'excelHtml5',
        //             title: 'Surrender_' + dateval
        //         }, {
        //             extend: 'pdfHtml5',
        //             title: 'Surrender_' + dateval
        //         }, {
        //             extend: 'print',
        //             title: 'Surrender_' + dateval
        //         }]
        //     });
        //     table.buttons().container(0, null)
        //         .insertBefore('div#surrender_wrapper.dataTables_wrapper');
        // };

        function rtd_gen_data(dateval) {
            console.log('rtd_gen_data', dateval);
            require.config({
                baseUrl: "{{ url_for('static', filename='js') }}",
                waitSeconds: 0,
                paths: {
                    spin: "spin.min"
                }
            });
            require(['spin'], function(Spinner) {
                var spinner = new Spinner(opts);
                if (document.getElementById('rtdgengraph2').style.display !== ""){
                    var target = document.getElementById('rtdgengraph2');
                } else {
                    var target = document.getElementById('rtdgen');
                }
                $.ajax({
                    url: "{{ url_for('ems.get_schedule_data') }}",
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        'date': dateval
                    }),
                    beforeSend: function(xhr, settings) {
                        var csrftoken = $('meta[name=csrf-token]').attr('content');
                        if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken)
                        }
                        spinner.spin(target);
                        dt = new Date();
                        console.log(dt + "rtd_gen_data***beforesend**" + dateval);
                    },
                    complete: function() {
                        console.log(dt + "rtd_gen_data***complete**" + dateval);
                        spinner.stop();
                    },
                    dataFilter: function(data) {
                        // console.log('dataFilter', data);
                        return data;
                    },
                    cache: false,
                    success: function(data) {
                        spinner.spin(target);
                        // console.log(data);
                        // rtd_generation_dt(dateval, data[0], data[1]);
                        rtd_generation_graph(data[0], data[1]);
                        console.log('rtd_gen_data success');
                        spinner.stop();
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(textStatus);
                        spinner.stop();
                    }
                });
            });
        };

        function rtd_generation_dt(dateval, data, column){
            console.log('rtd_gen_data_dt', dateval, data, column);
            var columns = [];
            for (var i = 0; i < column.length; i++) {
                var colobj = {
                    'data': column[i]
                };
                columns.push(colobj);
            };
            // console.log('columns', columns);
            var table = $('#rtdgen').DataTable({
                "scrollY": 404,
                "scrollX": true,
                "scrollCollapse": true,
                "responsive": true,
                // "paging": true,
                "deferRender": true,
                "lengthMenu": [[96, 80, 64, 48, 32, 16], [96, 80, 64, 48, 32, 16]],
                "iDisplayLength": 96,
                "order": [[0, 'asc'], [1, 'asc']],
                "data": data,
                "columns": columns,
                "destroy": true,
            });

            new $.fn.dataTable.Buttons( table, {
              buttons: [
                  {
                      extend: 'csvHtml5',
                      title: 'Quenext_Generation_' + dateval,
                        customize: function (csv) {
                            var header = '"Quenext"' + ',' + '"Power Generation"' +"\n\n";
                            // console.log('csv:', header + csv);
                            return header +  csv;
                        }
                  },
                  {
                      extend: 'excelHtml5',
                      title: 'Quenext_Generation_' + dateval,
                        customize: function (xlsx) {
                                // console.log('xlsx:', xlsx);
                                var sheet = xlsx.xl.worksheets['sheet1.xml'];
                                var downrows = 1;
                                var clRow = $('row', sheet);
                                //update Row
                                clRow.each(function () {
                                    var attr = $(this).attr('r');
                                    var ind = parseInt(attr);
                                    ind = ind + downrows;
                                    $(this).attr("r",ind);
                                });

                                // Update  row > c
                                $('row c ', sheet).each(function () {
                                    var attr = $(this).attr('r');
                                    var pre = attr.substring(0, 1);
                                    var ind = parseInt(attr.substring(1, attr.length));
                                    ind = ind + downrows;
                                    $(this).attr("r", pre + ind);
                                });

                                function Addrow(index,data) {
                                    msg='<row r="'+index+'">'
                                    for(i=0;i<data.length;i++){
                                        var key=data[i].k;
                                        var value=data[i].v;
                                        msg += '<c t="inlineStr" r="' + key + index + '" s="2">';
                                        msg += '<is>';
                                        msg +=  '<t>'+value+'</t>';
                                        msg+=  '</is>';
                                        msg+='</c>';
                                    }
                                    msg += '</row>';
                                    return msg;
                                }

                                //insert
                                var r1 = Addrow(1, [{ k: 'A', v: 'Quenext' }, { k: 'B', v: '' }, { k: 'C', v: 'Power Generation' }]);
                                // var r2 = Addrow(2, [{ k: 'A', v: '' }, { k: 'B', v: 'ColB' }, { k: 'C', v: '' }]);
                                // var r3 = Addrow(3, [{ k: 'A', v: '' }, { k: 'B', v: '' }, { k: 'C', v: 'ColC' }]);
                                // var img = document.createElement('img');
                                // img.src = "{{ url_for('static', filename='images/logo_large-Gray.png') }}";
                                // console.log(img.src);
                                sheet.childNodes[0].childNodes[1].innerHTML = r1 + sheet.childNodes[0].childNodes[1].innerHTML;
                            }
                  },
                  {
                      extend: 'pdfHtml5',
                      title: 'Quenext_Generation_' + dateval,
                      customize: function ( doc ) {
                        // Splice the image in after the header, but before the table
                        doc.content.splice( 0, 0, {
                            margin: [ 0, 0, 0, 5 ],
                            alignment: 'center',
                            image: quenext_logo,
                            // Data URL generated by http://dataurl.net/#dataurlmaker
                            width: 100,
                            height: 29
                        });
                      }
                  },
                  {
                      extend: 'print',
                      title: 'Quenext_Generation_' + dateval
                  },
              ]
            });
            table.buttons().container(0, null)
                .insertBefore('div#rtdgen_wrapper.dataTables_wrapper');
        };

        function rtd_generation_graph(data, columns){
            console.log('rtd_generation_graph');
            requirejs.config({
                baseUrl: "{{ url_for('static', filename='js') }}"
            });
            UniqueNames = [];
            for (var i = 0; i < columns.length; i++) {
                if (!(columns[i] === 'Date' || columns[i] === 'Revision' || columns[i] === 'Block_No' || columns[i] === 'NET_SCH' || columns[i] === 'Regulation')){
                    UniqueNames.push(columns[i]);
                };
            };
            var arr = []
            data.forEach(function(item) {
                UniqueNames.forEach(function(name) {
                    arr.push({
                        "date": item.Date,
                        "x": item.Block_No,
                        "y": item[name],
                        "drawl_type": name
                    });
                });
            });
            console.log('arr', arr);
            function d3cht(data){
                requirejs.config({
                    baseUrl: "{{ url_for('static', filename='js') }}"
                });

            require(["d3"], function(d3){
                console.log(d3.version);
                // console.log(nv.version);
                console.log(Object.keys(data).length);
                console.log('bnested',data);
                var nested_data = d3.nest()
                                  .key(function(d) { return d.drawl_type; })
                                  .entries(data);
                console.log('nesteed', nested_data);
                    require(["nv.d3.min"], function(nv){
                        nv = window.nv;
                        console.log(nv.version);
                        nv.addGraph(function() {
                            var chart = nv.models.multiBarChart();
                            //           .options({
                            //     transitionDuration: 300,
                            //     useInteractiveGuideline: true
                            // });
                            chart.xAxis.axisLabel("Block No").tickFormat(d3.format(',f'));
                            chart.yAxis.axisLabel('Supply (MW)').tickFormat(d3.format(',f'));
                            chart.tooltip.headerFormatter(function (d) { return 'Block No: ' + d});
                            d3.select('#chart2 svg')
                              .datum(nested_data)
                              .transition().duration(500)
                              .call(chart)
                              ;
                            nv.utils.windowResize(chart.update);
                            return chart;
                        });
                    });
                });
            };//d3cht end
            d3cht(arr);
        };

        function get_realtime_rev(dateval, discom, minmaxdata){
            $.ajax({
                url: "{{ url_for('ems.get_liveforecast_rev2') }}",
                dataType: "json",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    'date': dateval,
                    'discom': discom
                }),
                beforeSend: function(xhr, settings) {
                    var csrftoken = $('meta[name=csrf-token]').attr('content');
                    if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken)
                    }
                    // spinner.spin(target);
                    // dt = new Date();
                    // console.log(dt + "posmapgraph2***beforesend**" + dateval);
                },
                // complete: function() {
                //     // console.log(dt + "posmapgraph2***complete**" + dateval);
                //     // spinner.stop();
                // },
                dataFilter: function(data) {
                    // console.log('dataFilter', data);
                    return data;
                },
                cache: false,
                success: function(data) {
                    console.log('get_realtime_rev****', data);
                    var includepoolid = [10, 27, 28];
                    var minmaxarr = [];
                    if (minmaxdata.length > 0) {
                        for (var k in minmaxdata[0]){
                            var minmaxobj = {};
                            var poolid = parseInt(k.split("_")[0]);
                            if (includepoolid.indexOf(poolid) >= 0){
                                console.log('get_realtime_rev :', k);
                                if (poolid === 10) {
                                    data.forEach(function(arrayItem){
                                        if (arrayItem['model_type'] === 'SINK'){
                                            minmaxobj['Rev'] = arrayItem['revision'];
                                            minmaxobj['Type'] = 'DEMAND';
                                        }
                                    });
                                }  else if (poolid === 27) {
                                    data.forEach(function(arrayItem){
                                        if (arrayItem['model_type'] === 'INJECTION'){
                                            minmaxobj['Rev'] = arrayItem['revision'];
                                            minmaxobj['Type'] = 'WIND';
                                        }
                                    });
                                }  else if (poolid === 28) {
                                    data.forEach(function(arrayItem){
                                        if (arrayItem['model_type'] === 'INJECTION'){
                                            minmaxobj['Rev'] = arrayItem['revision'];
                                            minmaxobj['Type'] = 'SOLAR';
                                        }
                                    });
                                }
                                minmaxobj['Max'] = Math.max.apply(Math, minmaxdata.map(function(o){return o[k];}));
                                minmaxobj['Min'] = Math.min.apply(Math, minmaxdata.map(function(o){return o[k];}));
                                minmaxarr.push(minmaxobj);
                            }
                        };
                    }
                    console.log('minmaxarr:', minmaxarr);
                    if (minmaxarr.length > 0 && minmaxarr.length <= 3){
                        var restr = '<b>';
                        var wistr = '<b>';
                        var destr = '<b>';
                        minmaxarr.forEach(function(arrayItem){
                            if (arrayItem['Type'] === 'SOLAR'){
                                restr += arrayItem['Type']+ ':' + '&nbsp;';
                                restr += 'Rev:' + '&nbsp;' + arrayItem['Rev'] + '&nbsp;';
                                restr += 'Min:' + '&nbsp;' + arrayItem['Min'] + '&nbsp;';
                                restr += 'Max:' + '&nbsp;' + arrayItem['Max'] + '&nbsp;';
                            }  else if (arrayItem['Type'] === 'WIND'){
                                wistr += arrayItem['Type']+ ':' + '&nbsp;';
                                wistr += 'Rev:' + '&nbsp;' + arrayItem['Rev'] + '&nbsp;';
                                wistr += 'Min:' + '&nbsp;' + arrayItem['Min'] + '&nbsp;';
                                wistr += 'Max:' + '&nbsp;' + arrayItem['Max'] + '&nbsp;';
                            } else {
                                destr += arrayItem['Type']+ ':' + '&nbsp;';
                                destr += 'Rev:' + '&nbsp;' + arrayItem['Rev'] + '&nbsp;';
                                destr += 'Min:' + '&nbsp;' + arrayItem['Min'] + '&nbsp;';
                                destr += 'Max:' + '&nbsp;' + arrayItem['Max'] + '&nbsp;';
                            }
                        });
                        restr += '</b>';
                        destr += '</b>';
                        wistr += '</b>';
                        console.log('restr', restr);
                        console.log('destr', destr);
                        console.log('wistr', destr);
                        $("#reposrev2").empty();
                        $("#reposrev2").append(restr + '<br>' + wistr);
                        $("#forposrev2").empty();
                        $("#forposrev2").append(destr);
                    } else if (minmaxarr.length > 3){
                        var restr = '<b>';
                        var wistr = '<b>';
                        var destr = '<b>';
                        var solrev = '';
                        var winrev = '';
                        var demrev = '';
                        minmaxarr.forEach(function(arrayItem){
                            if (arrayItem['Type'] === 'SOLAR'){
                                restr = arrayItem['Type']+ ':' + '&nbsp;';
                                solrev = 'Rev:' + '&nbsp;' + arrayItem['Rev'] + '&nbsp;';
                            }  else if (arrayItem['Type'] === 'WIND'){
                                wistr = arrayItem['Type']+ ':' + '&nbsp;';
                                winrev = 'Rev:' + '&nbsp;' + arrayItem['Rev'] + '&nbsp;';
                            } else {
                                destr = arrayItem['Type']+ ':' + '&nbsp;';
                                demrev = 'Rev:' + '&nbsp;' + arrayItem['Rev'] + '&nbsp;';
                            }
                        });
                        restr = restr + solrev + '</b>';
                        destr = destr + demrev + '</b>';
                        wistr = wistr + winrev + '</b>';
                        $("#reposrev2").empty();
                        $("#reposrev2").append(restr + '<br>' + wistr);
                        $("#forposrev2").empty();
                        $("#forposrev2").append(destr);
                    } else {
                        $("#forposrev2").empty();
                        $("#reposrev2").empty();
                    }
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    console.log(textStatus);
                    // spinner.stop();
                }
            }); //$ajax end
        }

        function get_posmap_data(dateval, discom, level){
            // dateval = '22-06-2017';
            console.log('get_posmap_data', dateval);
            require.config({
                baseUrl: "{{ url_for('static', filename='js') }}",
                waitSeconds: 0,
                paths: {
                    spin: "spin.min"
                }
            });
            require(['spin'], function(Spinner) {
                var spinner = new Spinner(opts);
                if ($('#posmapgraph2').is(':visible')){
                    var target = document.getElementById('posmapgraph2');
                } else if ($('#posmaptab2').is(':visible')) {
                    var target = document.getElementById('posmaptab2');
                } else if ($('#formapgraph2').is(':visible')) {
                    var target = document.getElementById('formapgraph2');
                } else if ($('#formaptab2').is(':visible')) {
                    var target = document.getElementById('formaptab2');
                } else if ($('#reposmapgraph2').is(':visible')) {
                    var target = document.getElementById('reposmapgraph2');
                } else if ($('#reposmaptab2').is(':visible')) {
                    var target = document.getElementById('reposmaptab2');
                }

                $.ajax({
                    url: "{{ url_for('ems.get_liveposmap_datav2') }}",
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        'date': dateval,
                        'discom': discom,
                        'level': level
                    }),
                    beforeSend: function(xhr, settings) {
                        var csrftoken = $('meta[name=csrf-token]').attr('content');
                        if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken)
                        }
                        spinner.spin(target);
                        dt = new Date();
                        console.log(dt + "posmapgraph2***beforesend**" + dateval);
                    },
                    complete: function() {
                        console.log(dt + "posmapgraph2***complete**" + dateval);
                        spinner.stop();
                    },
                    dataFilter: function(data) {
                        // console.log('dataFilter', data);
                        return data;
                    },
                    cache: false,
                    success: function(data) {
                        console.log('livepos**', data);
                        relive_posmap(dateval, data, discom);
                        demlive_posmap(dateval, data, discom);
                        get_realtime_rev(dateval, discom, data);
                        spinner.spin(target);
                        var tableHeaders;
                        var tabcolumns = [];
                        $("#posmap").empty();
                        $("#posmapchart").empty();
                        if (data.length > 0) {
                            if ($.fn.dataTable.isDataTable('#posmap')) {
                                table = $('#posmap').DataTable();
                                table.destroy();
                                // table.ajax.reload( null, false );
                            }
                            tabcolumns.push({'data': 'Date'});
                            tabcolumns.push({'data': 'Block_No'});
                            for (var k in data[0]){
                                if (k.toLowerCase() !== 'date' && k.toLowerCase() !== 'block_no'){
                                    var colobj = {
                                        'data': k
                                    };
                                    tabcolumns.push(colobj);
                                }
                            };
                            console.log('tabcolumns:', tabcolumns);
                            $.each(tabcolumns, function(i, val){
                                $.each(val, function(key, newval){
                                    console.log('tabcolumns:', i,"---", newval);
                                    mystring = newval.replace(/_UNKNOWN/g, "");
                                    mystring = mystring.replace(/GENERATION/g, "GEN");
                                    mystring = mystring.replace(/OTHERS/g, "OTH");
                                    mystring = mystring.replace(/CONVENTIONAL/g, "CONV");
                                    tableHeaders += "<th>" + mystring + "</th>";
                                });
                            });
                            console.log('tableHeaders:', tableHeaders);
                            if (document.getElementById("posmap")){
                                document.getElementById("posmap").deleteTHead();
                            }
                            $("#posmap").append('<thead><tr>' + tableHeaders + '</tr></thead>');
                            // $('#posmap').html(tableHeaders);
                            live_posmap_dt(dateval, data, tabcolumns);
                            live_posmap_chart_v2(data);
                            // relive_posmap_dt(dateval, data, tabcolumns);
                            // relive_posmap_chart_v2(data);
                            console.log('get_posmap_data success');
                        }; //end of if

                        spinner.stop();
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(textStatus);
                        spinner.stop();
                    }
                });
            });
        }

        function live_posmap_dt(dateval, data, columns){
            console.log('live_posmap_dt', dateval, data);
            console.log('columns', columns);
            var table = $('#posmap').DataTable({
                "scrollY": 404,
                "scrollX": true,
                "scrollCollapse": true,
                "responsive": true,
                "paging": true,
                "deferRender": true,
                "lengthMenu": [[96, 80, 64, 48, 32, 16], [96, 80, 64, 48, 32, 16]],
                "iDisplayLength": 96,
                "order": [[0, 'asc'], [1, 'asc']],
                "data": data,
                "columns": columns,
                "destroy": true,
            });

            new $.fn.dataTable.Buttons( table, {
              buttons: [
                  {
                      extend: 'csvHtml5',
                      title: 'Quenext_Realtime_' + dateval
                  },
                  {
                      extend: 'excelHtml5',
                      title: 'Quenext_Realtime_' + dateval
                  },
                  {
                      extend: 'pdfHtml5',
                      title: 'Quenext_Realtime_' + dateval
                  },
                  {
                      extend: 'print',
                      title: 'Quenext_Realtime_' + dateval
                  },
              ]
            });
            table.buttons().container(0, null)
                .insertBefore('div#posmap_wrapper.dataTables_wrapper');
        };


        function live_posmap_chart_v2(data){
            console.log('live_posmap_chart_v2', data);
            var chartcolumns = [];
            // Object.keys(data[0]);
            var groupupcolumns = [];
            var excludpoolid = [18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 33, 34];
            var excludegrouppoolid = [1, 10, 12, 31, 27, 28, 29, 30, 32, 33, 34, 35];
            var charttypes = {};
            var chartcolor = {};
            var mystring = JSON.stringify(data);
            mystring = mystring.replace(/_UNKNOWN/g, "");
            mystring = mystring.replace(/GENERATION/g, "GEN");
            mystring = mystring.replace(/OTHERS/g, "OTH");
            mystring = mystring.replace(/CONVENTIONAL/g, "CONV");
            data = JSON.parse(mystring);
            for(var k in data[0]){
                // console.log('k:', k);
                if (k.toLowerCase() !== 'date' && excludpoolid.indexOf(parseInt(k.split("_")[0])) == -1){
                    chartcolumns.push(k);
                }
                if (k.toLowerCase() !== 'date' && k.toLowerCase() !== 'block_no'){
                    // console.log('k:', k);
                    if (excludegrouppoolid.indexOf(parseInt(k.split("_")[0])) >= 0){
                        if (parseInt(k.split("_")[0]) !== 12) {
                            charttypes[k] = 'line';
                        } else {
                            charttypes[k] = 'bar';
                        }
                        if (parseInt(k.split("_")[0]) === 1) {
                            chartcolor[k] = '#daa520';
                        } else if (parseInt(k.split("_")[0]) === 10) {
                            chartcolor[k] = '#e31a1c';
                        } else if (parseInt(k.split("_")[0]) === 31) {
                            chartcolor[k] = "#7f7f7f";
                        } else if (parseInt(k.split("_")[0]) === 32) {
                            chartcolor[k] = "#756bb1";
                        } else if (parseInt(k.split("_")[0]) === 27) {
                            chartcolor[k] = "#2ca02c";
                        } else if (parseInt(k.split("_")[0]) === 28) {
                            chartcolor[k] = "#98df8a";
                        } else if (parseInt(k.split("_")[0]) === 29) {
                            chartcolor[k] = "#ff9896";
                        } else if (parseInt(k.split("_")[0]) === 30) {
                            chartcolor[k] = "#9467bd";
                        }
                    } else {
                        groupupcolumns.push(k);
                    }
                }
            }

            console.log('gropupcolumns cols', groupupcolumns);
            console.log('chartcolumns cols', chartcolumns);
            console.log('chartcolumns charttypes', charttypes);
            console.log('chartcolumns chartcolor', chartcolor);
            require.config({
                baseUrl: "{{ url_for('static', filename='js') }}",
                waitSeconds: 0,
                paths: {
                    d3: "d3.min",
                    c3: "c3.min"
                }
            });//require end

            require(["d3", "c3"], function(d3, c3) {
                var chart = c3.generate({
                    bindto: "#posmapchart",
                    size: {
                        height: 480,
                        width: 960 + 150
                    },
                    padding: {
                        // top: 30,
                        // bottom: 20
                    },
                    data: {
                        json: data,
                        keys: {
                            x: 'Block_No',
                            value: chartcolumns
                        },
                        type: "area-spline",
                        types: charttypes,
                        // types: {
                        //     '10_GUVNL': 'line',
                        //     '1_TOTALDEMAND': 'line'
                        // },
                        groups: [groupupcolumns],
                        colors: chartcolor,
                        // colors: {
                        //     '1_TOTALDEMAND': '#daa520',
                        //     '10_GUVNL': '#e31a1c'
                        // },
                        axes: {},
                        labels: false,
                        // regions: {
                        //     RT_DEMAND_FORECAST: [{'start':1, 'end':96, 'style': 'dashed'}]
                        // },
                        empty: {
                            label: {
                                text: "No Data"
                            }
                        },
                    },
                    axis: {
                        x: {
                            //    type: 'categorized'
                            label: {
                                text: 'Block No',
                                position: 'outer-center'
                            },
                            height: 80,
                            tick: {
                                fit: true,
                                width: 20,
                                // rotate: 75,
                                // count: 96 * 4,
                                // format: function(x) {
                                //     var zero = d3.format("02d");
                                //     return zero(x) + ' ' + zero(Math.floor(x / 4)) + 'h'
                                // },
                                culling: {
                                    max: 48
                                }
                            }
                        },
                        y: {
                            label: {
                                text: 'Quantum (MW)',
                                position: 'outer-middle'
                            },
                            padding: {
                                top: 2,
                                bottom: 3
                            },
                        }
                    },
                    grid: {
                        y: {
                            show: true
                        },
                        x: {
                            show: true
                        },
                        focus: {
                            show: true
                        }
                    },
                    legend: {
                        //position: 'right',
                        show: true
                    },
                    point: {
                        show: false
                    },
                    transition: {
                        duration: 100
                    },
                    tooltip: {
                        format: {
                            title: function(d) {
                                timestrfmt = d3.format("02d");
                                return 'Block_No ' + d +
                                    ' Time ' + timestrfmt(Math.floor(d * 15 / 60)) + ':' + (timestrfmt(((d * 15 / 60) - Math.floor(d * 15 / 60)) * 60));
                            }
                        }
                    },
                    regions: [
                        {axis: 'x', start: 21, end: 31},
                        {axis: 'x', start: 73, end: 92}
                    ],
                    color: {
                        pattern : ['#1f77b4', '#aec7e8', '#ff7f0e', '#ffbb78', '#2ca02c', '#98df8a', '#ff9896', '#9467bd', '#c5b0d5', '#8c564b', '#c49c94', '#f7b6d2', '#7f7f7f', '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5']
                    },
                    zoom: {
                        enabled: true,
                        rescale: true,
                        extent: [1, 100]
                    }
                });//end chart
            });//end require
        }; //live_posmap_chart_v2 ends;

        function relive_posmap(dateval, data, discom){
            console.log('relive_posmap', data);
            $("#reposmap").empty();
            $("#reposmapchart").empty();
            var includepoolid = [18, 19, 27, 28, 33, 34];
            var tableHeaders;
            var tabcolumns = [];
            if (data.length > 0) {
                if ($.fn.dataTable.isDataTable('#reposmap')) {
                    table = $('#reposmap').DataTable();
                    table.destroy();
                    // table.ajax.reload( null, false );
                }
                tabcolumns.push({'data': 'Date'});
                tabcolumns.push({'data': 'Block_No'});
                for (var k in data[0]){
                    if (includepoolid.indexOf(parseInt(k.split("_")[0])) >= 0){
                        var colobj = {
                            'data': k
                        };
                        tabcolumns.push(colobj);
                    }
                };
                console.log('retabcolumns:', tabcolumns);
                $.each(tabcolumns, function(i, val){
                    $.each(val, function(key, newval){
                        console.log('tabcolumns:', i,"---", newval);
                        mystring = newval.replace(/_UNKNOWN/g, "");
                        mystring = mystring.replace(/GENERATION/g, "GEN");
                        mystring = mystring.replace(/OTHERS/g, "OTH");
                        mystring = mystring.replace(/CONVENTIONAL/g, "CONV");
                        tableHeaders += "<th>" + mystring + "</th>";
                    });
                });
                console.log('retableHeaders:', tableHeaders);
                if (document.getElementById("reposmap")){
                    document.getElementById("reposmap").deleteTHead();
                }
                $("#reposmap").append('<thead><tr>' + tableHeaders + '</tr></thead>');
                relive_posmap_dt(dateval, data, tabcolumns);
                relive_posmap_chart_v2(data);
            }
        };


        function relive_posmap_dt(dateval, data, columns){
            console.log('relive_posmap_dt', dateval, data);
            console.log('columns', columns);
            var table = $('#reposmap').DataTable({
                "scrollY": 404,
                "scrollX": true,
                "scrollCollapse": true,
                "responsive": true,
                "paging": true,
                "deferRender": true,
                "lengthMenu": [[96, 80, 64, 48, 32, 16], [96, 80, 64, 48, 32, 16]],
                "iDisplayLength": 96,
                "order": [[0, 'asc'], [1, 'asc']],
                "data": data,
                "columns": columns,
                "destroy": true,
            });

            new $.fn.dataTable.Buttons( table, {
              buttons: [
                  {
                      extend: 'csvHtml5',
                      title: 'Quenext_RERealtime_' + dateval
                  },
                  {
                      extend: 'excelHtml5',
                      title: 'Quenext_RERealtime_' + dateval
                  },
                  {
                      extend: 'pdfHtml5',
                      title: 'Quenext_RERealtime_' + dateval
                  },
                  {
                      extend: 'print',
                      title: 'Quenext_RERealtime_' + dateval
                  },
              ]
            });
            table.buttons().container(0, null)
                .insertBefore('div#reposmap_wrapper.dataTables_wrapper');
        };

        function relive_posmap_chart_v2(data){
            console.log('relive_posmap_chart_v2', data);
            var chartcolumns = [];
            // Object.keys(data[0]);
            var groupupcolumns = [];
            var includepoolid = [18, 19, 27, 28, 33, 34];
            var excludegrouppoolid = [1, 10, 12, 31, 27, 28, 29, 30, 32, 33, 34, 35];
            var charttypes = {};
            var chartcolor = {};
            var mystring = JSON.stringify(data);
            mystring = mystring.replace(/_UNKNOWN/g, "");
            mystring = mystring.replace(/GENERATION/g, "GEN");
            mystring = mystring.replace(/OTHERS/g, "OTH");
            mystring = mystring.replace(/CONVENTIONAL/g, "CONV");
            data = JSON.parse(mystring);
            for(var k in data[0]){
                // console.log('k:', k);
                if (k.toLowerCase() !== 'date' && includepoolid.indexOf(parseInt(k.split("_")[0])) >= 0){
                    chartcolumns.push(k);
                }
                if (k.toLowerCase() !== 'date' && k.toLowerCase() !== 'block_no' && includepoolid.indexOf(parseInt(k.split("_")[0])) >= 0){
                    // console.log('k:', k);
                    if (excludegrouppoolid.indexOf(parseInt(k.split("_")[0])) >= 0){
                        if (parseInt(k.split("_")[0]) !== 12) {
                            charttypes[k] = 'line';
                        } else {
                            charttypes[k] = 'bar';
                        }
                        if (parseInt(k.split("_")[0]) === 1) {
                            chartcolor[k] = '#daa520';
                        } else if (parseInt(k.split("_")[0]) === 10) {
                            chartcolor[k] = '#e31a1c';
                        } else if (parseInt(k.split("_")[0]) === 31) {
                            chartcolor[k] = "#7f7f7f";
                        } else if (parseInt(k.split("_")[0]) === 27) {
                            chartcolor[k] = "#2ca02c";
                        } else if (parseInt(k.split("_")[0]) === 28) {
                            chartcolor[k] = "#98df8a";
                        } else if (parseInt(k.split("_")[0]) === 29) {
                            chartcolor[k] = "#ff9896";
                        } else if (parseInt(k.split("_")[0]) === 30) {
                            chartcolor[k] = "#9467bd";
                        }
                    } else {
                        groupupcolumns.push(k);
                    }
                }
            }

            console.log('relive_posmap_chart_v2 gropupcolumns cols', groupupcolumns);
            console.log('relive_posmap_chart_v2 chartcolumns cols', chartcolumns);
            console.log('relive_posmap_chart_v2 chartcolumns charttypes', charttypes);
            console.log('relive_posmap_chart_v2 chartcolumns chartcolor', chartcolor);
            require.config({
                baseUrl: "{{ url_for('static', filename='js') }}",
                waitSeconds: 0,
                paths: {
                    d3: "d3.min",
                    c3: "c3.min"
                }
            });//require end

            require(["d3", "c3"], function(d3, c3) {
                var chart = c3.generate({
                    bindto: "#reposmapchart",
                    size: {
                        height: 480,
                        width: 960 + 150
                    },
                    padding: {
                        // top: 30,
                        // bottom: 20
                    },
                    data: {
                        json: data,
                        keys: {
                            x: 'Block_No',
                            value: chartcolumns
                        },
                        //type: "area-spline",
                        types: charttypes,
                        // types: {
                        //     '10_GUVNL': 'line',
                        //     '1_TOTALDEMAND': 'line'
                        // },
                        // groups: [groupupcolumns],
                        colors: chartcolor,
                        // colors: {
                        //     '1_TOTALDEMAND': '#daa520',
                        //     '10_GUVNL': '#e31a1c'
                        // },
                        axes: {},
                        labels: false,
                        // regions: {
                        //     RT_DEMAND_FORECAST: [{'start':1, 'end':96, 'style': 'dashed'}]
                        // },
                        empty: {
                            label: {
                                text: "No Data"
                            }
                        },
                    },
                    axis: {
                        x: {
                            //    type: 'categorized'
                            label: {
                                text: 'Block No',
                                position: 'outer-center'
                            },
                            height: 80,
                            tick: {
                                fit: true,
                                width: 20,
                                // rotate: 75,
                                // count: 96 * 4,
                                // format: function(x) {
                                //     var zero = d3.format("02d");
                                //     return zero(x) + ' ' + zero(Math.floor(x / 4)) + 'h'
                                // },
                                culling: {
                                    max: 48
                                }
                            }
                        },
                        y: {
                            label: {
                                text: 'Quantum (MW)',
                                position: 'outer-middle'
                            },
                            padding: {
                                top: 2,
                                bottom: 3
                            },
                        }
                    },
                    grid: {
                        y: {
                            show: true
                        },
                        x: {
                            show: true
                        },
                        focus: {
                            show: true
                        }
                    },
                    legend: {
                        //position: 'right',
                        show: true
                    },
                    point: {
                        show: false
                    },
                    transition: {
                        duration: 100
                    },
                    tooltip: {
                        format: {
                            title: function(d) {
                                timestrfmt = d3.format("02d");
                                return 'Block_No ' + d +
                                    ' Time ' + timestrfmt(Math.floor(d * 15 / 60)) + ':' + (timestrfmt(((d * 15 / 60) - Math.floor(d * 15 / 60)) * 60));
                            }
                        }
                    },
                    regions: [
                        // {axis: 'x', start: 21, end: 31},
                        // {axis: 'x', start: 73, end: 92}
                    ],
                    color: {
                        pattern : ['#1f77b4', '#aec7e8', '#ff7f0e', '#ffbb78', '#2ca02c', '#98df8a', '#ff9896', '#9467bd', '#c5b0d5', '#8c564b', '#c49c94', '#f7b6d2', '#7f7f7f', '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5']
                    },
                    zoom: {
                        enabled: true,
                        rescale: true,
                        extent: [1, 100]
                    }
                });//end chart
            });//end require
        }; //live_posmap_chart_v2 ends;


        function demlive_posmap(dateval, data, discom){
            console.log('demlive_posmap', data);
            $("#formaptabdt").empty();
            $("#formapchart").empty();
            var includepoolid = [1, 10, 32];
            var tableHeaders;
            var tabcolumns = [];
            if (data.length > 0) {
                if ($.fn.dataTable.isDataTable('#formaptabdt')) {
                    table = $('#formaptabdt').DataTable();
                    table.destroy();
                    // table.ajax.reload( null, false );
                }
                tabcolumns.push({'data': 'Date'});
                tabcolumns.push({'data': 'Block_No'});
                for (var k in data[0]){
                    if (includepoolid.indexOf(parseInt(k.split("_")[0])) >= 0){
                        var colobj = {
                            'data': k
                        };
                        tabcolumns.push(colobj);
                    }
                };
                console.log('formaptabdt:', tabcolumns);
                $.each(tabcolumns, function(i, val){
                    $.each(val, function(key, newval){
                        console.log('tabcolumns:', i,"---", newval);
                        mystring = newval.replace(/_UNKNOWN/g, "");
                        mystring = mystring.replace(/GENERATION/g, "GEN");
                        mystring = mystring.replace(/OTHERS/g, "OTH");
                        mystring = mystring.replace(/CONVENTIONAL/g, "CONV");
                        tableHeaders += "<th>" + mystring + "</th>";
                    });
                });
                console.log('fortableHeaders:', tableHeaders);
                if (document.getElementById("formaptabdt")){
                    document.getElementById("formaptabdt").deleteTHead();
                }
                $("#formaptabdt").append('<thead><tr>' + tableHeaders + '</tr></thead>');
                demlive_posmap_dt(dateval, data, tabcolumns);
                console.log('demlive_posmap2**', data);
                demlive_posmap_chart_v2(data);
            }
        };

        function demlive_posmap_dt(dateval, data, columns){
            console.log('demlive_posmap_dt', dateval, data);
            console.log('columns', columns);
            var table = $('#formaptabdt').DataTable({
                "scrollY": 404,
                "scrollX": true,
                "scrollCollapse": true,
                "responsive": true,
                "paging": true,
                "deferRender": true,
                "lengthMenu": [[96, 80, 64, 48, 32, 16], [96, 80, 64, 48, 32, 16]],
                "iDisplayLength": 96,
                "order": [[0, 'asc'], [1, 'asc']],
                "data": data,
                "columns": columns,
                "destroy": true,
            });

            new $.fn.dataTable.Buttons( table, {
              buttons: [
                  {
                      extend: 'csvHtml5',
                      title: 'Quenext_RTDemand_' + dateval
                  },
                  {
                      extend: 'excelHtml5',
                      title: 'Quenext_RTDemand_' + dateval
                  },
                  {
                      extend: 'pdfHtml5',
                      title: 'Quenext_RTDemand_' + dateval
                  },
                  {
                      extend: 'print',
                      title: 'Quenext_RTDemand_' + dateval
                  },
              ]
            });
            table.buttons().container(0, null)
                .insertBefore('div#formaptabdt_wrapper.dataTables_wrapper');
        };

        function demlive_posmap_chart_v2(data){
            console.log('demlive_posmap_chart_v2', data);
            var chartcolumns = [];
            // Object.keys(data[0]);
            var groupupcolumns = [];
            var includepoolid = [1, 10, 32];
            var excludegrouppoolid = [1, 10, 12, 31, 27, 28, 29, 30, 32, 33, 34, 35];
            var charttypes = {};
            var chartcolor = {};
            var mystring = JSON.stringify(data);
            mystring = mystring.replace(/_UNKNOWN/g, "");
            mystring = mystring.replace(/GENERATION/g, "GEN");
            mystring = mystring.replace(/OTHERS/g, "OTH");
            mystring = mystring.replace(/CONVENTIONAL/g, "CONV");
            data = JSON.parse(mystring);
            // console.log('demlive_posmap_chart_v2***2', data);
            for(var k in data[0]){
                // console.log('k:', k);
                if (k.toLowerCase() !== 'date' && includepoolid.indexOf(parseInt(k.split("_")[0])) >= 0){
                    chartcolumns.push(k);
                }
                if (k.toLowerCase() !== 'date' && k.toLowerCase() !== 'block_no' && includepoolid.indexOf(parseInt(k.split("_")[0])) >= 0){
                    // console.log('k:', k);
                    if (excludegrouppoolid.indexOf(parseInt(k.split("_")[0])) >= 0){
                        if (parseInt(k.split("_")[0]) !== 12) {
                            charttypes[k] = 'line';
                        } else {
                            charttypes[k] = 'bar';
                        }
                        if (parseInt(k.split("_")[0]) === 1) {
                            chartcolor[k] = '#e31a1c';
                        } else if (parseInt(k.split("_")[0]) === 10) {
                            chartcolor[k] = '#86af49';
                        } else if (parseInt(k.split("_")[0]) === 31) {
                            chartcolor[k] = "#7f7f7f";
                        } else if (parseInt(k.split("_")[0]) === 27) {
                            chartcolor[k] = "#2ca02c";
                        } else if (parseInt(k.split("_")[0]) === 28) {
                            chartcolor[k] = "#98df8a";
                        } else if (parseInt(k.split("_")[0]) === 29) {
                            chartcolor[k] = "#ff9896";
                        } else if (parseInt(k.split("_")[0]) === 30) {
                            chartcolor[k] = "#9467bd";
                        } else if (parseInt(k.split("_")[0]) === 32) {
                            chartcolor[k] = "#000000";
                        }
                    } else {
                        groupupcolumns.push(k);
                    }
                }
            }

            console.log('demlive_posmap_chart_v2 gropupcolumns cols', groupupcolumns);
            console.log('demlive_posmap_chart_v2 chartcolumns cols', chartcolumns);
            console.log('demlive_posmap_chart_v2 chartcolumns charttypes', charttypes);
            console.log('demlive_posmap_chart_v2 chartcolumns chartcolor', chartcolor);
            require.config({
                baseUrl: "{{ url_for('static', filename='js') }}",
                waitSeconds: 0,
                paths: {
                    d3: "d3.min",
                    c3: "c3.min"
                }
            });//require end

            require(["d3", "c3"], function(d3, c3) {
                var chart = c3.generate({
                    bindto: "#formapchart",
                    size: {
                        height: 480,
                        width: 960 + 150
                    },
                    padding: {
                        // top: 30,
                        // bottom: 20
                    },
                    data: {
                        json: data,
                        keys: {
                            x: 'Block_No',
                            value: chartcolumns
                        },
                        //type: "area-spline",
                        types: charttypes,
                        // types: {
                        //     '10_GUVNL': 'line',
                        //     '1_TOTALDEMAND': 'line'
                        // },
                        // groups: [groupupcolumns],
                        colors: chartcolor,
                        // colors: {
                        //     '1_TOTALDEMAND': '#daa520',
                        //     '10_GUVNL': '#e31a1c'
                        // },
                        axes: {},
                        labels: false,
                        // regions: {
                        //     RT_DEMAND_FORECAST: [{'start':1, 'end':96, 'style': 'dashed'}]
                        // },
                        empty: {
                            label: {
                                text: "No Data"
                            }
                        },
                    },
                    axis: {
                        x: {
                            //    type: 'categorized'
                            label: {
                                text: 'Block No',
                                position: 'outer-center'
                            },
                            height: 80,
                            tick: {
                                fit: true,
                                width: 20,
                                // rotate: 75,
                                // count: 96 * 4,
                                // format: function(x) {
                                //     var zero = d3.format("02d");
                                //     return zero(x) + ' ' + zero(Math.floor(x / 4)) + 'h'
                                // },
                                culling: {
                                    max: 48
                                }
                            }
                        },
                        y: {
                            label: {
                                text: 'Quantum (MW)',
                                position: 'outer-middle'
                            },
                            padding: {
                                top: 2,
                                bottom: 3
                            },
                        }
                    },
                    grid: {
                        y: {
                            show: true
                        },
                        x: {
                            show: true
                        },
                        focus: {
                            show: true
                        }
                    },
                    legend: {
                        //position: 'right',
                        show: true
                    },
                    point: {
                        show: false
                    },
                    transition: {
                        duration: 100
                    },
                    tooltip: {
                        format: {
                            title: function(d) {
                                timestrfmt = d3.format("02d");
                                return 'Block_No ' + d +
                                    ' Time ' + timestrfmt(Math.floor(d * 15 / 60)) + ':' + (timestrfmt(((d * 15 / 60) - Math.floor(d * 15 / 60)) * 60));
                            }
                        }
                    },
                    regions: [
                        // {axis: 'x', start: 21, end: 31},
                        // {axis: 'x', start: 73, end: 92}
                    ],
                    color: {
                        pattern : ['#1f77b4', '#aec7e8', '#ff7f0e', '#ffbb78', '#2ca02c', '#98df8a', '#ff9896', '#9467bd', '#c5b0d5', '#8c564b', '#c49c94', '#f7b6d2', '#7f7f7f', '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5']
                    },
                    zoom: {
                        enabled: true,
                        rescale: true,
                        extent: [1, 100]
                    }
                });//end chart
            });//end require
        }; //demlive_posmap_chart_v2 ends;

        // function rtd_gen_data(dateval){
        //     console.log("rtd_gen_data");
        //     if ( $.fn.dataTable.isDataTable( '#rtdgen' ) ) {
        //         table = $('#rtdgen').DataTable();
        //         console.log("rtd_gen_data:" + table);
        //         table.destroy();
        //         table.ajax.reload( null, false );
        //         console.log("rtd_gen_data.1");
        //     };

        //     var table = $('#rtdgen').DataTable({
        //         "scrollY": 404,
        //         //"scrollX": true,
        //         // "scrollCollapse": true,
        //         //"responsive": true,
        //         // "paging": true,
        //         "deferRender": true,
        //         "lengthMenu": [[96, 80, 64, 48, 32, 16], [96, 80, 64, 48, 32, 16]],
        //         "iDisplayLength": 96,
        //         "order": [[0, 'asc'], [1, 'asc']],
        //         // "sAjaxSource": "{#{ url_for('get_erschedule_data') }#}",
        //         // "processing": true,
        //         // "serverSide": true,
        //         "ajax": {
        //             "url": "{{ url_for('ems.get_schedule_data') }}",
        //             "type": "POST",
        //             "data": function ( d ) {
        //                         d.date = dateval;
        //                         // d.discom = $('#discomselector').val();
        //             },
        //         }
        //     });
        //     new $.fn.dataTable.Buttons( table, {
        //       buttons: [
        //           {
        //               extend: 'csvHtml5',
        //               title: 'Generation_' + dateval
        //           },
        //           {
        //               extend: 'excelHtml5',
        //               title: 'Generation_' + dateval
        //           },
        //           {
        //               extend: 'pdfHtml5',
        //               title: 'Generation_' + dateval
        //           },
        //           {
        //               extend: 'print',
        //               title: 'Generation_' + dateval
        //           },
        //       ]
        //     });
        //     table.buttons().container(0, null)
        //         .insertBefore('div#rtdgen_wrapper.dataTables_wrapper');
        // };

        function genstackgraph(date){
            $.ajax({url: 'get_genstacked_data/' + date,// "nrldcdata/RAJASTHAN/" + message,
                    dataType: "json",
                    //data: "FD_16-11-2009",
                    //type: "GET",
                    contentType: "application/json; charset=utf-8",
                    dataFilter: function(data) { return data; },
                    success: function(data) {
                        //console.log(data);
                        console.log("success");
                        console.log("stacked_test");
                        d3cht(data);
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        alert(textStatus);
                    }
            });
            function d3cht(data){
                requirejs.config({
                    baseUrl: "{{ url_for('static', filename='js') }}"
                });

            require(["d3"], function(d3){
                console.log(d3.version);
                // console.log(nv.version);
                console.log(Object.keys(data).length);
                console.log('bnested',data);
                var nested_data = d3.nest()
                                  .key(function(d) { return d.drawl_type; })
                                  .entries(data);
                console.log('nesteed', nested_data);
                    require(["nv.d3.min"], function(nv){
                        nv = window.nv;
                        console.log(nv.version);
                        nv.addGraph(function() {
                            var chart = nv.models.multiBarChart();
                            //           .options({
                            //     transitionDuration: 300,
                            //     useInteractiveGuideline: true
                            // });
                            chart.xAxis.axisLabel("Block No").tickFormat(d3.format(',f'));
                            chart.yAxis.axisLabel('Supply (MW)').tickFormat(d3.format(',f'));
                            chart.tooltip.headerFormatter(function (d) { return 'Block No: ' + d});
                            d3.select('#chart2 svg')
                              .datum(nested_data)
                              .transition().duration(500)
                              .call(chart)
                              ;
                            nv.utils.windowResize(chart.update);
                            return chart;
                        });
                    });
                });
            };
        };

        var pos_data = [];
        var pos_data2 = {};
        function livechart(date){
            $.ajax({url: "get_biharlive_data/" + date,
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    dataFilter: function(data) { return data; },
                    success: function(data) {
                        console.log(data);
                        console.log("success");
                        types = {};
                        axes = {};
                        group_arg = []
                        pos_data2 = JSON.parse(JSON.stringify(data));
                        pos_data = JSON.parse(JSON.stringify(pos_data2));
                        var length = Object.keys(pos_data2).length;
                        console.log(pos_data);
                        // for (var i = 0; i < length; i++){
                        // pos_data[i]["live_demand"] = null;
                        // console.log(i);
                        // for (var j = i; j < length; j++){
                          // console.log("j" + j);
                          // pos_data = JSON.parse(JSON.stringify(data));
                          // pos_data[j]["live_demand"] = null;
                        // };
                        // if (i > 0){
                        //   setTimeout(function(){
                        //     c3cht(types, axes, group_arg);
                        //   }, 10000);
                        // }
                        // else{
                        //   c3cht(types, axes, group_arg);
                        // }
                        // };
                        c3cht(types, axes, group_arg);
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                              alert(textStatus);
                    }
            });
        };

        function c3cht(type_arg, axes_arg, group_arg){
            require.config({
                // baseUrl: '/static/js'
                baseUrl: "{{ url_for('static', filename='js') }}",
                paths: {d3: "d3.min",
                        c3: "c3.min"
                }
            });

            require(["d3", "c3"], function(d3, c3){
                var chart = c3.generate({
                    bindto: "#chart",
                    size: {
                          height: 480 - 50,
                          width: 960 + 150
                    },
                    data: {
                        json : pos_data,
                        keys : {
                            x: 'block_no',
                            value: ['int_gen', 'ER_gen', 'forecast', 'live_demand', 'live_forecast', 'live_demand_NBPDCL',
                            'live_forecast_NBPDCL', 'live_demand_SBPDCL', 'live_forecast_SBPDCL', 'revised_position_BPDCL']
                        },
                        type: "area-spline",
                        types: {
                            forecast: 'line',
                            live_forecast: 'line',
                            live_demand: 'line',
                            live_demand_NBPDCL: 'line',
                            live_forecast_NBPDCL: 'line',
                            live_demand_SBPDCL: 'line',
                            live_forecast_SBPDCL: 'line',
                            revised_position_BPDCL: 'bar'
                        },
                        groups: [['int_gen', 'ER_gen']],
                        colors: {
                                  // live_forecast: d3.rgb('#ff0000').darker(2)
                        },
                        axes: axes_arg,
                        labels: false,
                        regions: {live_forecast: [{'start':1, 'end':96, 'style': 'dashed'}],
                                  live_forecast_NBPDCL: [{'start':1, 'end':96, 'style': 'dashed'}],
                                  live_forecast_SBPDCL: [{'start':1, 'end':96, 'style': 'dashed'}]
                        }
                    },
                    axis: {
                        x: {
                            //    type: 'categorized'
                            label: {
                               text: 'Block No',
                               position: 'outer-center'
                            },
                            tick: {
                              //fit: true
                              //count: 96//,
                              //format:
                            }
                        },
                        y: {
                          label: {
                                    text: 'Quantum (MW)',
                                    position: 'outer-middle'
                          }
                        }
                    },
                    grid: {
                        y: {
                            show: true
                        },
                        x: {
                            show: true
                        },
                        focus: {
                            show: true
                        }
                    },
                    legend: {
                            //position: 'right',
                            show: true
                    },
                    point: {
                            show: false
                    },
                    transition: {
                            duration: 100
                    },
                    tooltip: {
                        format: {
                            title: function (d) { return 'Block_No ' + d; }
                        }
                    },
                    regions: [
                        {axis: 'x', start: 21, end: 31},
                        {axis: 'x', start: 73, end: 92}
                    ],
                    color: {
                    }
                });
            });
        };
        $(document).ready(function(){
            ko.cleanNode(document.getElementById('rtdmontab'));
            ko.applyBindings(LivePosMapViewModel, document.getElementById('rtdmontab'));

            // $( document ).on( 'click', '.bs-dropdown-to-select-group .dropdown-menu li', function( event ) {
            //     var $target = $( event.currentTarget );
            //     $target.closest('.bs-dropdown-to-select-group')
            //         .find('[data-bind="bs-drp-sel-value"]').val($target.attr('data-value'))
            //         .end()
            //         .children('.dropdown-toggle').dropdown('toggle');
            //     $target.closest('.bs-dropdown-to-select-group')
            //         .find('[data-bind="bs-drp-sel-label"]').text($target.attr('data-value'));/*$target.text()*/
            //     return false;
            // });
            // LiveDropDownChange();

            // $(".dropdown-menu li a").click(function(){
            //     console.log('Dropdown activated', this, 'This', $(this), 'This Parent',$(this).parents(".btn-group"), 'This Parent find', $(this).parents(".btn-group").find('.selection'));
            //     $(this).parents(".input-group-btn").find('.selection').text($(this).text());
            //     $(this).parents(".input-group-btn").find('.selection').val($(this).text());
            // });

            $( '#dateselector' ).datepicker({
                format: "dd-mm-yyyy",
                todayBtn: "linked",
                todayHighlight: true,
                autoclose: true
            });

            // $( '#dateselector' ).datepicker("setDate", new Date());
            $( '#dateselector' ).datepicker("update", "{{ serverdate }}");

            calldovalidate(); //Default

            // $( '#Select,input[name="date"]' ).bind({
            //   click: function(){
            //     calldovalidate();
            //     },
            //   focusout: function(){
            //     calldovalidate();
            //     },
            //   keydown: function(){
            //     calldovalidate();
            //     },
            //   change: function(){
            //     calldovalidate();
            //     }
            // });

            $( '#Select,input[name="date"]' ).bind("change", function(){
                console.log('DoValidate click, focusout, change, keydown started');
                calldovalidate();
            });


            // $('#selectmodel').bind({
            //     // click: function(){
            //     //   calldovalidate();
            //     //   },
            //     focusout: function() {
            //         calldovalidate();
            //     },
            //     keydown: function() {
            //         calldovalidate();
            //     },
            //     change: function() {
            //         calldovalidate();
            //     }
            // });

            $('#aggLevel').bind({
                // click: function(){
                //   calldovalidate();
                //   },
                focusout: function() {
                    calldovalidate();
                    // console.log('aggLevel1');
                },
                keydown: function() {
                    calldovalidate();
                    // console.log('aggLevel2');
                },
                change: function() {
                    calldovalidate();
                    // console.log('aggLevel3');
                }
            });

            // $( '#selectmodel' ).bind("change", function(){
            //     console.log('selectmodel change started');
            //     calldovalidate();
            // });

            // $( '#input-mrr' ).bind("change", debounce(function(){
            //         console.log('mrr changed');
            //         update_liveposmap_data();
            //     }, 20)
            // );

            $('#update_mrr_model').on('click', function () {
                console.log('update_mrr_model updating', $(this));
                var $btn = $(this).button('loading');
                var buttonval = function(){
                    $btn.button('reset');
                }
                update_liveposmap_data(buttonval);
            });

            $('#posmapModal').on('shown.bs.modal', function(e) {
                clearInterval(myVar);
                console.log('posmapModal Shown event');
                $.fn.dataTable
                .tables( { visible: true, api: true } )
                .columns.adjust();
            });

            $('#posmapModal').on('hidden.bs.modal', function(e) {
                clearInterval(myVar);
                myVar = setInterval(myTimer, 90000);
            });

            // function rtd(dateval) {
            //     console.log("rtd");
            //     if ($.fn.dataTable.isDataTable('#rtd')) {
            //         table = $('#rtd').DataTable();
            //         console.log("rtd:" + table);
            //         table.destroy();
            //         table.ajax.reload(null, false);
            //         console.log("rtd");
            //     }

            //     var table = $('#rtd').DataTable({
            //         "scrollY": 404,
            //         "scrollX": true,
            //         // "scrollCollapse": true,
            //         //"responsive": true,
            //         // "paging": true,
            //         "deferRender": true,
            //         "lengthMenu": [
            //             [96, 80, 64, 48, 32, 16],
            //             [96, 80, 64, 48, 32, 16]
            //         ],
            //         "iDisplayLength": 96,
            //         "order": [
            //             [0, 'desc'],
            //             [1, 'desc'],
            //             [2, 'asc'],
            //         ],
            //         "ajax": {
            //             // "url": "{#{ url_for('ems.get_biharmislive_data') }#}",
            //             "url": "{{ url_for('ems.get_liveposmap_data') }}",
            //             "type": "POST",
            //             "data": function(d) {
            //                 d.date = dateval;
            //                 d.discom = $('#discomselector').val();
            //                 d.model = $('#selectmodel').val();
            //             }
            //         },
            //         "fixedColumns":{
            //             "leftColumns": 3
            //         }
            //     });

            //     new $.fn.dataTable.Buttons(table, {
            //         // buttons: ['csv', 'excel', 'pdf', 'print']
            //         buttons: [{
            //             extend: 'csvHtml5',
            //             title: 'RealTime_' + dateval
            //         }, {
            //             extend: 'excelHtml5',
            //             title: 'RealTime_' + dateval
            //         }, {
            //             extend: 'pdfHtml5',
            //             title: 'RealTime_' + dateval
            //         }, {
            //             extend: 'print',
            //             title: 'RealTime_' + dateval
            //         }, ]
            //     });
            //     table.buttons().container(0, null)
            //         .insertBefore('div#rtd_wrapper.dataTables_wrapper');
            // };

            $('#rtdmongraph').click(function() {
                $('#rtdmongraph').toggle();
                $('#rtdmontabular').toggle();
                $("div#rtdmongraph2").toggle();
                $("div#rtdmontab2").toggle();
                // $('#reposrev').hide();
                // $('#forposrev').hide();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('rtdmongraph');
            });
            $('#rtdmontabular').click(function() {
                $('#rtdmontabular').toggle();
                $('#rtdmongraph').toggle();
                $("div#rtdmontab2").toggle();
                $("div#rtdmongraph2").toggle();
                // $('#reposrev').hide();
                // $('#forposrev').hide();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('rtdmontabular');
            });
            $('#rtdsurrgraph').click(function() {
                $('#rtdsurrgraph').toggle();
                $('#rtdsurrtabular').toggle();
                $("div#rtdsurrgraph2").toggle();
                $("div#rtdsurrtab2").toggle();
                // $('#reposrev').hide();
                // $('#forposrev').hide();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('rtdsurrgraph');
                clearInterval(myVar);
            });
            $('#rtdsurrtabular').click(function() {
                $('#rtdsurrtabular').toggle();
                $('#rtdsurrgraph').toggle();
                $("div#rtdsurrtab2").toggle();
                $("div#rtdsurrgraph2").toggle();
                // $('#reposrev').hide();
                // $('#forposrev').hide();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('rtdsurrtabular');
                clearInterval(myVar);
            });
            $('#rtdgengraph').click(function() {
                $('#rtdgengraph').toggle();
                $('#rtdgentabular').toggle();
                $("div#rtdgengraph2").toggle();
                $("div#rtdgentab2").toggle();
                // $('#reposrev').hide();
                // $('#forposrev').hide();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('rtdgengraph');
                clearInterval(myVar);
            });
            $('#rtdgentabular').click(function() {
                $('#rtdgentabular').toggle();
                $('#rtdgengraph').toggle();
                $("div#rtdgentab2").toggle();
                $("div#rtdgengraph2").toggle();
                // $('#reposrev').hide();
                // $('#forposrev').hide();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('rtdgentabular');
                clearInterval(myVar);
            });
            $('#posmapgraph').click(function() {
                $('#posmapgraph').toggle();
                $('#posmaptabular').toggle();
                $("div#posmapgraph2").toggle();
                $("div#posmaptab2").toggle();
                // $('#reposrev').hide();
                // $('#forposrev').hide();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('posmapgraph');
                clearInterval(myVar);
            });
            $('#posmaptabular').click(function() {
                $('#posmaptabular').toggle();
                $('#posmapgraph').toggle();
                $("div#posmaptab2").toggle();
                $("div#posmapgraph2").toggle();
                // $('#reposrev').hide();
                // $('#forposrev').hide();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('posmapgraphtabular');
                clearInterval(myVar);
            });
            $('#reposmapgraph').click(function() {
                $('#reposmapgraph').toggle();
                $('#reposmaptabular').toggle();
                $("div#reposmapgraph2").toggle();
                $("div#reposmaptab2").toggle();
                // $('#reposrev').show();
                // $('#forposrev').hide();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('reposmapgraph');
                clearInterval(myVar);
            });
            $('#reposmaptabular').click(function() {
                $('#reposmaptabular').toggle();
                $('#reposmapgraph').toggle();
                $("div#reposmaptab2").toggle();
                $("div#reposmapgraph2").toggle();
                // $('#reposrev').show();
                // $('#forposrev').hide();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('reposmapgraphtabular');
                clearInterval(myVar);
            });
            $('#formapgraph').click(function() {
                $('#formapgraph').toggle();
                $('#formaptabular').toggle();
                $("div#formapgraph2").toggle();
                $("div#formaptab2").toggle();
                // $('#reposrev').hide();
                // $('#forposrev').show();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('formapgraph');
            });
            $('#formaptabular').click(function() {
                $('#formaptabular').toggle();
                $('#formapgraph').toggle();
                $("div#formapgraph2").toggle();
                $("div#formaptab2").toggle();
                // $('#reposrev').hide();
                // $('#forposrev').show();
                $.fn.dataTable.tables({visible: true, api: true} ).columns.adjust();
                console.log('formaptabular');
            });
            $( '#myTab a[href="#rtdmontab"]' ).click(function(e){
                e.preventDefault();
                // $('#selectmodel').show();
                // $('#inputgr-mrr').show();
                $('#type_mrr_model').show();
                $('#update_mrr_model').show();
                $('#aggDiv').hide();
                $('#reposrev').hide();
                $('#forposrev').hide();
                $(this).tab('show');
                console.log(this);
                myVar = setInterval(myTimer, 90000);
                // calldovalidate();

                // if ($("#rtdmongraph").is(":visible") == true ){
                //     // livechart($('input[name="date"]').val());
                // } else {
                //     // rtdposmap($('input[name="date"]').val());
                //     LivePosMapViewModel.load();
                // };
            });
            $( '#myTab a[href="#rtdsurrtab"]' ).click(function(e){
                e.preventDefault();
                // $('#selectmodel').show();
                // $('#inputgr-mrr').show();
                $('#type_mrr_model').hide();
                $('#update_mrr_model').hide();
                $('#aggDiv').hide();
                $('#reposrev').hide();
                $('#forposrev').hide();
                $(this).tab('show');
                console.log(this);
                // rtdsurrender($('input[name="date"]').val());
                rtd_surr_rev($('input[name="date"]').val(), $('#discomselector').val());
                clearInterval(myVar);
            });
            $( '#myTab a[href="#rtdgentab"]' ).click(function(e){
                e.preventDefault();
                // $('#selectmodel').hide();
                // $('#inputgr-mrr').hide();
                $('#type_mrr_model').hide();
                $('#update_mrr_model').hide();
                $('#aggDiv').hide();
                $('#reposrev').hide();
                $('#forposrev').hide();
                $(this).tab('show');
                console.log(this);
                rtd_gen_data($('input[name="date"]').val());
                // if ($("#rtdgengraph").is(":visible") == true ){
                //     genstackgraph($('input[name="date"]').val());
                // } else {
                //     rtd_gen_data($('input[name="date"]').val());
                // };
                clearInterval(myVar);
            });
            $( '#myTab a[href="#updatedata"]' ).click(function(e){
                // $('#selectmodel').hide();
                // $('#inputgr-mrr').hide();
                $('#type_mrr_model').hide();
                $('#update_mrr_model').hide();
                $('#aggDiv').hide();
                $('#reposrev').hide();
                $('#forposrev').hide();
            });
            $( '#myTab a[href="#posmaptab"]' ).click(function(e){
                e.preventDefault();
                $('#type_mrr_model').show();
                $('#update_mrr_model').show();
                $('#aggDiv').show();
                $('#reposrev').hide();
                $('#forposrev').hide();
                $(this).tab('show');
                console.log(this);
                get_posmap_data($('input[name="date"]').val(), $('#discomselector').val(), $('#aggLevel').val());
            });
            $( '#myTab a[href="#reposmaptab"]' ).click(function(e){
                e.preventDefault();
                $('#type_mrr_model').show();
                $('#update_mrr_model').show();
                $('#aggDiv').show();
                $('#reposrev').show();
                $('#forposrev').hide();
                $(this).tab('show');
                console.log(this);
                get_posmap_data($('input[name="date"]').val(), $('#discomselector').val(), $('#aggLevel').val());
            });
            $( '#myTab a[href="#formaptab"]' ).click(function(e){
                e.preventDefault();
                $('#type_mrr_model').show();
                $('#update_mrr_model').show();
                $('#aggDiv').show();
                $('#reposrev').hide();
                $('#forposrev').show();
                $(this).tab('show');
                console.log(this);
                get_posmap_data($('input[name="date"]').val(), $('#discomselector').val(), $('#aggLevel').val());
            });
        });

        function start_isgs_task(callback) {
            // add task status elements
            div = $('<div class="progressisgs"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            $('#isgsprogress').append(div);

            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                // url: '/ems/erldc_crawler_task',
                url: '/ems/isgs_crawler_task',
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0], callback);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        };

        function start_bseb_task(callback) {
            // add task status elements
            div = $('<div class="progressbseb"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            $('#bsebprogress').append(div);

            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                url: '/ems/bseb_crawler_task',
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0], callback);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        };

        function start_bseb_task2(callback) {
            // add task status elements
            div = $('<div class="progressbseb2"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            $('#bseb2progress').append(div);

            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                url: '/ems/bseb_crawler_task',
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0], callback);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        };

        function update_progress(status_url, nanobar, status_div, callback) {
            // send GET request to status URL
            $.getJSON(status_url, function(data) {
                console.log(data['current']);
                console.log(data['total']);
                console.log("Percentage" + parseInt(data['current'] * 100 / data['total']));
                // update UI
                percent = parseInt(data['current'] * 100 / data['total']);
                nanobar.go(percent);
                $(status_div.childNodes[1]).text(percent + '%');
                $(status_div.childNodes[2]).text(data['status']);
                if (data['state'] != 'PENDING' && data['state'] != 'PROGRESS') {
                    if ('result' in data) {
                        // show result
                        $(status_div.childNodes[3]).text('Result: ' + data['result']);
                    }
                    else {
                        // something unexpected happened
                        $(status_div.childNodes[3]).text('Result: ' + data['state']);
                    }
                    if (callback) {
                        callback();
                    }
                }
                else {
                    // rerun in 2 seconds
                    setTimeout(function() {
                        update_progress(status_url, nanobar, status_div, callback);
                    }, 25000);
                }
            });
        };

        function update_progress_no_bar(status_url, callback) {
            $.getJSON(status_url, function(data) {
                console.log(data['current']);
                console.log(data['total']);
                console.log(data['state']);
                var status = '';
                if (data['state'] != 'PENDING' && data['state'] != 'PROGRESS') {
                    if ('result' in data) {
                        // show result
                        status = data['result'];
                    }
                    else {
                        // something unexpected happened
                        status = data['result'];
                    }
                    if (callback) {
                        callback();
                    }
                }
                else {
                    // rerun in 2 seconds
                    setTimeout(function() {
                        update_progress_no_bar(status_url, callback);
                    }, 8000);
                }
            });
        }; //function status end

        function start_weather_task(callback) {
            // add task status elements
            div = $('<div class="progressweather"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            $('#weatherprogress').append(div);
            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                url: '/ems/weatherupload_task/' + $('#discomselector').val(),
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0], callback);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        };

        $(function() {
            $('#start-isgs-job').click(function(){
                var $btn = $(this).button('loading');
                var buttonval = function(){
                    $btn.button('reset');
                }
                start_isgs_task(buttonval);
            });
        });

        $(function() {
            $('#start-bseb-job').click(function(){
                var $btn = $(this).button('loading');
                var buttonval = function(){
                    $btn.button('reset');
                }
                start_bseb_task(buttonval);
            });
        });

        $(function() {
            $('#start-internal-job').click(function(){
                var $btn = $(this).button('loading');
                var buttonval = function(){
                    $btn.button('reset');
                }
                start_bseb_task2(buttonval);
            });
        });

        $(function() {
            $('#start-weather-job').click(function(){
                var $btn = $(this).button('loading');
                var buttonval = function(){
                    $btn.button('reset');
                }
                start_weather_task(buttonval);
            });
        });
    </script>
{% endblock %}
{% block header %}
    <form id="defaultForm" method="post" class="navbar-form navbar-left form-inline" role="form">
        <div class="row">
            <div class="form-group">
<!--                 <div class='input-group date'>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                    <input class="form-control" type="text" placeholder="dd-mm-yyyy"  id="dateselector" name="date" size="10">
                </div> -->
                <input class="form-control" type="text" placeholder="dd-mm-yyyy"  id="dateselector" name="date" size="10">
                <div class="input-group" id='type_mrr_model'>
                    <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" id="type_dropdown" aria-expanded="true"></button>
<!--                         <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                            <li><a href="#" data-value="Demand">Demand</a></li>
                            <li><a href="#" data-value="Generation">Generation</a></li>
                        </ul> -->
                    </div><!-- /btn-group -->
                    <span class="input-group-addon" data-toggle="tooltip" data-placement="bottom" title="Mean Reversion Rate">MRR</span>
                    <input class="form-control" type="number" id="input-mrr" name="inputmrr" value="0.2" min="0" max="1" step="0.1">
                    <span class="input-group-addon" data-toggle="tooltip" data-placement="bottom" title="Model">Model</span>
                    <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" id="selectmodel" aria-expanded="true"></button>
<!--                         <ul class="dropdown-menu" aria-labelledby="selectmodel">
                            {% if request.path.startswith('/ems') and (model_name|first) is not none %}
                                {% for org_model in model_name %}
                                    <li><a href="#" data-value="{{ org_model.get('model_name') }}">{{ org_model.get('model_short_name') }}</a></li>
                                {% endfor %}
                            {% endif %}
                        </ul> -->
                    </div><!-- /btn-group -->
                </div>
                <button type="button" class="btn btn-primary" id='update_mrr_model' data-loading-text="Updating...">Commit</button>
            </div>
        </div>
    </form>
{% endblock %}
{% block content %}
    <div class="container">
        <div id='aggDiv' class="row">
            <div class="col-xs-3">
                <div class="form-group">
                    <select id='aggLevel' class="selectpicker" form-control data-width="fit">
                        <option value="POOL_NAME">Pool Name</option>
                        <option selected="selected" value="POOL_TYPE">Pool Type</option>
                        <option value="UNIT_NAME">Unit Name</option>
                    </select>
                </div>
            </div>
        </div>
        <div role="tabpanel">
            <ul id="myTab" class="nav nav-tabs" role="tablist">
                <li role="presentation"  class="active"><a href="#rtdmontab" aria-controls="#rtdmontab" role="tab" data-toggle="tab"><span id="rtdmongraph" class="glyphicon glyphicon-stats"></span><span id="rtdmontabular" class="glyphicon glyphicon-list"></span> Dyn Pos Map</a></li>
                <li role="presentation"><a href="#rtdsurrtab" aria-controls="#rtdsurrtab" role="tab" data-toggle="tab"><span id="rtdsurrgraph" class="glyphicon glyphicon-stats"></span><span id="rtdsurrtabular" class="glyphicon glyphicon-list"></span> Allocation Opt</a></li>
                <li role="presentation"><a href="#rtdgentab" aria-controls="#rtdgentab" role="tab" data-toggle="tab"><span id="rtdgengraph" class="glyphicon glyphicon-stats"></span><span id="rtdgentabular" class="glyphicon glyphicon-list"></span> Generation </a></li>
                <li role="presentation"><a href="#formaptab" aria-controls="#formaptab" role="tab" data-toggle="tab"><span id ="formapgraph" class="glyphicon glyphicon-stats"></span><span id="formaptabular" class="glyphicon glyphicon-list"></span> RT Demand</a></li>
                <li role="presentation"><a href="#posmaptab" aria-controls="#posmaptab" role="tab" data-toggle="tab"><span id ="posmapgraph" class="glyphicon glyphicon-stats"></span><span id="posmaptabular" class="glyphicon glyphicon-list"></span> New Pos Map</a></li>
                <li role="presentation"><a href="#reposmaptab" aria-controls="#reposmaptab" role="tab" data-toggle="tab"><span id ="reposmapgraph" class="glyphicon glyphicon-stats"></span><span id="reposmaptabular" class="glyphicon glyphicon-list"></span> RE Generation</a></li>
                {% if current_user.has_roles(['admin', 'jobrunner', 'analytics']) %}
                <li role="presentation"><a href="#updatedata" aria-controls="#updatedata" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-refresh"></span> Refresh Data</a></li>
                {% else %}
                <li role="presentation" class="disabled"><a href="#updatedata" aria-controls="updatedata" role="tab" data-toggle=""><span class="glyphicon glyphicon-refresh"></span> Refresh Data</a></li>
                {% endif %}                
            </ul>
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="rtdmontab">
                    <div id="rtdmongraph2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <div id="chart"></div>
                            </div>
                        </div>
                    </div>
                    <div id="rtdmontab2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <table id="rtd" class="display nowrap table table-striped table-bordered table-condensed table-hover" cellspacing="0" width="100%">
                                    <thead>
                                        <tr>
                                            {% for col in rtd_columns %}
                                            <th>{{ col }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% if current_user.has_roles(['admin', 'jobrunner', 'analytics']) %}
                    <div class="center-block" style="max-width:0px" id="editposmap">
                        <button class="btn btn-primary" data-toggle="modal" data-target="#posmapModal" data-bind="visible: livepositems().length > 0">Edit</button>
                    </div>
                    {% endif %}
                    <!-- Modal -->
                    <div class="modal custom fade" id="posmapModal" tabindex="-1" role="dialog" aria-labelledby="posmapLargeModalLabel">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="posmapModalLabel">Live Position Map Bias</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="container">
                                        <div class="col-md-12 content">
                                            <table id="posmapedit" class="table table-striped table-bordered table-condensed table-hover" cellspacing="0" width="100%" data-bind="visible: livepositems().length > 0">
                                                <thead>
                                                    <tr>
                                                        {% for col in rtd_columns %}
                                                        <th>{{ col }}</th>
                                                        {% endfor %}
                                                    </tr>
                                                </thead>
                                                <tbody data-bind="dataTablesForEach: {data: livepositems, dataTableOptions: {
                                                                    scrollX: true,
                                                                    scrollY: 404,
                                                                    scrollCollapse: true,
                                                                    responsive: true,
                                                                    paging: true,
                                                                    destroy: true,
                                                                    deferRender: true,
                                                                    lengthMenu: [
                                                                            [96, 80, 64, 48, 32, 16],
                                                                            [96, 80, 64, 48, 32, 16]
                                                                    ],
                                                                    iDisplayLength: 96,
                                                                    order: [
                                                                        [0, 'desc'],
                                                                        [1, 'asc']
                                                                    ]
                                                                }
                                                            }">
                                                    <tr data-bind="foreach: columns">
                                                        <td data-bind="template: { name: $parent.templateToUse($data) }"> </td>
                                                    </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-bind="click: reset" data-dismiss="modal" id="posmapModalCloseButton">Cancel and Close</button>
                                    <button class="btn btn-primary" type="button" data-bind="click: save" data-dismiss="modal" >Commit</button>
                                </div>
                                <!-- knockout template start-->
                                <script id="read" type="text/html">
                                    <div data-bind=" text: $parent[$data]"><div>
                                </script>
                                <script id="write" type="text/html">
                                    <input style="width: 4em" type="numeric" data-bind="value: $parent[$data], valueUpdate: 'afterkeydown'"/>
                                </script>
                                <!-- knockout template end-->
                            </div>
                        </div>
                    </div>
                    <!-- Modal -->
                </div>
                <div role="tabpanel" class="tab-pane" id="rtdsurrtab">
                    <div id="rtdsurrgraph2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <div id="surrchart" class='with-3d-shadow with-transitions'>
                                    <svg></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="rtdsurrtab2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <table id="surrender" class="table table-striped table-bordered table-condensed table-hover" cellspacing="0" width="100%">
<!--                                     <thead>
                                        <tr>
                                            {% for col in surr_columns %}
                                            <th>{{ col }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead> -->
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="rtdgentab">
                    <div id="rtdgengraph2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <div class='with-3d-shadow with-transitions'>
                                    <div id="chart2">
                                        <svg></svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="rtdgentab2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <table id="rtdgen" class="table table-striped table-bordered table-condensed table-hover" cellspacing="0" width="100%">
                                    <thead>
                                        <tr>
                                            {% for col in gen_columns %}
                                            <th>{{ col }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="updatedata">
                <br>
                    <div class="container">
                        <div class="col-md-12 content">
                            <button type="button" class="btn btn-default btn-sm btn-custom" id="start-isgs-job" data-loading-text="Running...">ISGS</button><br><br>
                            <div id="isgsprogress"></div>
                        </div>
<!--                         <div class="col-md-12 content">
                            <button type="button" class="btn btn-default btn-sm btn-custom" id="start-bseb-job" data-loading-text="Running...">INTERNAL</button><br><br>
                            <div id="bsebprogress"></div>
                        </div>
                        <div class="col-md-12 content">
                            <button type="button" class="btn btn-default btn-sm btn-custom" id="start-internal-job" data-loading-text="Running...">RTD</button><br><br>
                            <div id="bseb2progress"></div>
                        </div> -->
                        <div class="col-md-12 content">
                            <button type="button" class="btn btn-default btn-sm btn-custom" id="start-weather-job" data-loading-text="Running...">WEATHER</button><br><br>
                            <div id="weatherprogress"></div>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane active" id="posmaptab">
                    <div id="posmapgraph2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <div id="posmapchart"></div>
                            </div>
                        </div>
                    </div>
                    <div id="posmaptab2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <table id="posmap" class="display nowrap table table-striped table-bordered table-condensed table-hover" cellspacing="0" width="100%">
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane active" id="formaptab">
                    <div id="formapgraph2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <div id="formapchart"></div>
                            </div>
                        </div>
                    </div>
                    <div id="formaptab2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <table id="formaptabdt" class="display nowrap table table-striped table-bordered table-condensed table-hover" cellspacing="0" width="100%">
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="forposrev">
                        <div class="container">
                            <div class="row text-center">
                                <div id='forposrev2' class="redBlock">
                                    <!-- <b> Rev: 0 Min: 100 Max: 100</b> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane active" id="reposmaptab">
                    <div id="reposmapgraph2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <div id="reposmapchart"></div>
                            </div>
                        </div>
                    </div>
                    <div id="reposmaptab2">
                        <div class="container">
                            <div class="col-md-12 content">
                                <table id="reposmap" class="display nowrap table table-striped table-bordered table-condensed table-hover" cellspacing="0" width="100%">
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="reposrev">
                        <div class="container">
                            <div class="row text-center">
                                <div id='reposrev2' class="redBlock">
                                    <!-- <b>Wind Rev: 0 Min: 100 Max: 100</b><br> -->
                                    <!-- <b>Solar Rev: 0 Min: 100 Max: 100</b> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- /.container -->
{% endblock %}
