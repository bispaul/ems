<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="Navigation Page.">
    <meta name="author" content="">
    <!-- <link rel="icon" href="../../favicon.ico"> -->
    <title>Zeerone Jobs</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/datepicker.css') }}"> -->
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/minisubmenu.css') }}"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sticky-footer-navbar.css') }}">
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.css') }}"> -->
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/c3.css') }}"> -->
     <style>
      .bars {
        display: block;
        width: 20px;
        height: 3px;    
        background-color: #333;
        box-shadow: 0 5px 0 #333, 0 10px 0 #333;
      }
      .nav>li>a:hover, .nav>li>a:focus {
        text-decoration: none;
        background-color: #fff;
      }
      .nav .open>a, .nav .open>a:hover, .nav .open>a:focus {
        background-color: #fff;
        border-color: #428bca;
      } 
    </style>
    <script src="{{ url_for('static', filename='js/jquery-2.1.3.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <!-- // <script src="{{ url_for('static', filename='js/bootstrap-datepicker.js') }}"></script> -->
    <script src="{{ url_for('static', filename='js/nanobar.min.js') }}"></script> 
    <script>
        function start_long_task() {
            // add task status elements
            // div = $('#jobs').append('<div class="progress"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            div = $('<div class="progressbseb"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');            
            $('#progress').append(div);

            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                url: '/erldc_crawler_task',
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0]);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        }
        function start_bseb_task() {
            // add task status elements
            // div = $('#jobs').append('<div class="progress"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            div = $('<div class="progressbseb"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');            
            $('#progressbseb').append(div);

            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                url: '/bseb_crawler_task',
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0]);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        }
        function start_bsebdataupload_task() {
            // add task status elements
            // div = $('#jobs').append('<div class="progress"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            div = $('<div class="progressbseb"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');            
            $('#bsebdataupload').append(div);

            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                url: '/bseb_dataupload_task',
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0]);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        }
        function start_bsebweather_task() {
            // add task status elements
            // div = $('#jobs').append('<div class="progress"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            div = $('<div class="progressbseb"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');            
            $('#bsebweatherload').append(div);

            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                url: '/bseb_weatherupload_task',
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0]);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        }
        function start_exchange_task() {
            // add task status elements
            // div = $('#jobs').append('<div class="progress"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            div = $('<div class="progressbseb"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');            
            $('#exchangeload').append(div);

            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                url: '/exchange_upload_task',
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0]);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        }
        function start_forecast_task() {
            // add task status elements
            // div = $('#jobs').append('<div class="progress"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            div = $('<div class="progressbseb"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');            
            $('#forecastload').append(div);

            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                url: '/forecast_upload_task',
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0]);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        } 
        function start_rforecast_task() {
            // add task status elements
            // div = $('#jobs').append('<div class="progress"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
            div = $('<div class="progressbseb"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');            
            $('#rforecastload').append(div);

            // create a progress bar
            var nanobar = new Nanobar({
                bg: '#44f',
                target: div[0].childNodes[0]
            });

            // send ajax POST request to start background job
            $.ajax({
                type: 'POST',
                url: '/bseb_rforecast_task',
                success: function(data, status, request) {
                    status_url = request.getResponseHeader('Location');
                    update_progress(status_url, nanobar, div[0]);
                },
                error: function() {
                    alert('Unexpected error');
                }
            });
        }                                                  
        function update_progress(status_url, nanobar, status_div) {
            // send GET request to status URL
            $.getJSON(status_url, function(data) {
                console.log(data['current']);
                console.log(data['total']);
                console.log("Percentage" + parseInt(data['current'] * 100 / data['total']));
                // update UI
                percent = parseInt(data['current'] * 100 / data['total']);
                nanobar.go(percent);
                $(status_div.childNodes[1]).text(percent + '%');
                $(status_div.childNodes[2]).text(data['status']);
                if (data['state'] != 'PENDING' && data['state'] != 'PROGRESS') {
                    if ('result' in data) {
                        // show result
                        $(status_div.childNodes[3]).text('Result: ' + data['result']);
                    }
                    else {
                        // something unexpected happened
                        $(status_div.childNodes[3]).text('Result: ' + data['state']);
                    }
                }
                else {
                    // rerun in 2 seconds
                    setTimeout(function() {
                        update_progress(status_url, nanobar, status_div);
                    }, 2000);
                }
            });
        }
        $(function() {
            $('#start-bg-job').click(start_long_task);
        });
        $(function() {
            $('#start-bseb-job').click(start_bseb_task);
        });
        $(function() {
            $('#start-bsebdataupload-job').click(start_bsebdataupload_task);
        });
        $(function() {
            $('#start-weather-job').click(start_bsebweather_task);
        });
        $(function() {
            $('#start-exchange-job').click(start_exchange_task);
        });
        $(function() {
            $('#start-forecast-job').click(start_forecast_task);
        });  
        $(function() {
            $('#start-rforecast-job').click(start_rforecast_task);
        });                                                 
    </script>       
  </head>
  <body>
    <header class="top" role="header">
      <div class="container">
        <nav class="navbar" role="navigation">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a href="#" class="navbar-brand">
                <img style="margin-top:-20px;" src="/static/images/logo.png" alt="Z-matics">
              </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              {% include "menu.html" %}               
              <ul class="nav navbar-nav navbar-right">
                <li><a href="http://zeerone.com/">About</a></li>
                <li><a href="http://zeerone.com/contact_us.html">Contact</a></li>
                <li>
                  <a href="login.html">Logout </a>
                </li>
              </ul>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
    </header>
    <!-- Site banner -->
    <div class="banner">
        <div class="container">
          <div class="col-md-9 content">
            <h1><small>Jobs</small></h1>
          </div>
        </div>
    </div>
    <div class="middle">
      <div class="container">
        <div class="col-md-12 content">
          <button id="start-bg-job">ERLDC Update</button><br><br>
          <div id="progress"></div>        
        </div> 
        <div class="col-md-12 content">
          <button id="start-bseb-job">BSEB RTD Update</button><br><br>
          <div id="progressbseb"></div>        
        </div>
        <div class="col-md-12 content">
          <button id="start-bsebdataupload-job">BSEB History Load</button><br><br>
          <div id="bsebdataupload"></div>        
        </div>
        <div class="col-md-12 content">
          <button id="start-weather-job">Weather Update</button><br><br>
          <div id="bsebweatherload"></div>        
        </div>         
        <div class="col-md-12 content">
          <button id="start-exchange-job">Power Exchange Update</button><br><br>
          <div id="exchangeload"></div>        
        </div>
        <div class="col-md-12 content">
          <button id="start-rforecast-job">Generate Forecast</button><br><br>
          <div id="rforecastload"></div>        
        </div>         
        <div class="col-md-12 content">
          <button id="start-forecast-job">Forecast Bias Correction</button><br><br>
          <div id="forecastload"></div>        
        </div>                        
      </div> 
    </div>      
  </body>        
  <footer class="footer">
    <div class="container">
      <p class="text-muted">
          Zeerone © 2012
          http://www.zeerone.com</p>
      </div>
    </div>      
  </footer>
</html>